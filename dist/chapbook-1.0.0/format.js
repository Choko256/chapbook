window.storyFormat({"author":"Chris Klimas","name":"Chapbook","proofing":false,"source":"<!DOCTYPE html><html><head><title>{{STORY_NAME}}</title><meta charset=utf-8><meta name=viewport content=\"width=device-width,initial-scale=1\"><style>.fade-in{opacity:0;animation:a 1s forwards}@keyframes a{0%{opacity:0}to{opacity:1}}*{box-sizing:border-box}body{font-family:Hoefler Text,Calisto MT,Georgia,serif;font-size:20px;color:#2e3436;background:#eceff1;margin:0;display:flex;flex-direction:column;justify-content:center;align-items:center;transition:background-color 1s ease-in-out}a{color:#050505;text-decoration-color:#e91e63}a:hover{color:#e91e63}img{max-width:100%;height:auto}tw-storydata{display:none}.page{width:35em;max-width:calc(100vw - 2em);line-height:150%;min-height:calc(100vh - 2em);margin:1em;padding:2em;display:flex;flex-direction:column;justify-content:center;background:#fff;box-shadow:0 4px 8px rgba(0,0,0,.25)}.page article{flex-grow:1}.page footer,.page header{display:flex}.page footer span,.page header span{flex-grow:1}.page footer .center,.page header .center{text-align:center}.page footer .right,.page header .right{text-align:right}.page header{margin-top:0}.page header.has-content{border-bottom:1px solid #000}.page footer{margin-bottom:0}.page footer.has-content{border-top:1px solid #000}.small-caps{text-transform:uppercase;font-size:70%;letter-spacing:.075em}</style></head><body><div class=page aria-live=polite><header></header><article></article><footer></footer></div>{{STORY_DATA}}<script>!function(){var e={black:\"#000000\",white:\"#ffffff\",red:\"#f44336\",\"pale red\":\"#ffebee\",\"light red\":\"#ef9a9a\",\"dark red\":\"#b71c1c\",pink:\"#e91e63\",\"pale pink\":\"#fce4ec\",\"light pink\":\"#f48fb1\",\"dark pink\":\"#880e4f\",purple:\"#9c27b0\",\"pale purple\":\"#f3e5f5\",\"light purple\":\"#ce93d8\",\"dark purple\":\"#4a148c\",\"deep purple\":\"#673ab7\",\"pale deep purple\":\"#ede7f6\",\"light deep purple\":\"#b39ddb\",\"dark deep purple\":\"#311b92\",indigo:\"#3f51b5\",\"pale indigo\":\"#e8eaf6\",\"light indigo\":\"#9fa8da\",\"dark indigo\":\"#1a237e\",blue:\"#2196f3\",\"pale blue\":\"#e3f2fd\",\"light blue\":\"#90caf9\",\"dark blue\":\"#0d47a1\",cyan:\"#00bcd4\",\"pale cyan\":\"#e0f7fa\",\"light cyan\":\"#80deea\",\"dark cyan\":\"#006064\",teal:\"#009688\",\"pale teal\":\"#e0f2f1\",\"light teal\":\"#80cbc4\",\"dark teal\":\"#004d40\",green:\"#4caf50\",\"pale green\":\"#e8f5e9\",\"light green\":\"#a5d6a7\",\"dark green\":\"#1b5e20\",lime:\"#cddc39\",\"pale lime\":\"#f9fbe7\",\"light lime\":\"#e6ee9c\",\"dark lime\":\"#827717\",yellow:\"#ffeb3b\",\"pale yellow\":\"#fffde7\",\"light yellow\":\"#fff59d\",\"dark yellow\":\"#f57f17\",amber:\"#ffc107\",\"pale amber\":\"#fff8e1\",\"light amber\":\"#ffe082\",\"dark amber\":\"#ff6f00\",orange:\"#ff9800\",\"pale orange\":\"#fff3e0\",\"light orange\":\"#ffcc80\",\"dark orange\":\"#e65100\",brown:\"#795548\",\"pale brown\":\"#efebe9\",\"light brown\":\"#bcaaa4\",\"dark brown\":\"#3e2723\",gray:\"#9e9e9e\",\"pale gray\":\"#fafafa\",\"light gray\":\"#eeeeee\",\"dark gray\":\"#212121\",\"blue gray\":\"#607d8b\",\"pale blue gray\":\"#eceff1\",\"light blue gray\":\"#b0bec5\",\"dark blue gray\":\"#263238\"};function t(t){return e[t]||t}function n(e,t){return e+\"{\"+Object.keys(t).reduce(function(e,n){return e+n+\":\"+t[n]+\";\"},\"\")+\"}\"}var r=function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),s=function(){function e(){r(this,e),this.props={bg:\"pale blue gray\",fg:\"dark gray\",font:\"Georgia, serif\",fontSize:18,googleFont:\"\"}}return i(e,[{key:\"css\",value:function(){var e,r=n(\"body\",{\"background-color\":t(this.props.bg),color:t(this.props.fg),\"font-size\":(e=this.props.fontSize,\"number\"==typeof e?e+\"px\":e),\"font-family\":this.props.font});return\"\"!==this.props.googleFont&&(this.googleImport||(this.googleImport=document.createElement(\"div\"),document.body.appendChild(this.googleImport)),this.googleImport.innerHTML=this.props.googleFont),r}}]),e}(),a=function(){function e(){r(this,e),this.props={linkActiveColor:\"pink\",linkColor:\"dark gray\",linkStyle:\"underline\",linkLineColor:\"pink\"}}return i(e,[{key:\"css\",value:function(){var e={color:t(this.props.linkColor),\"text-decoration-color\":t(this.props.linkLineColor)};switch(this.props.linkStyle){case\"none\":break;case\"underline\":e[\"text-decoration\"]=\"underline\";break;case\"small caps\":e[\"text-transform\"]=\"uppercase\",e[\"font-size\"]=\"75%\",e[\"letter-spacing\"]=\"0.02em\";break;default:throw new Error('There is no link style named \"'+this.props.linkStyle+'\".')}return n(\"a\",e)+n(\"a.hover\",{color:t(this.props.linkActiveColors)})}}]),e}();var u=function(){function e(){r(this,e),this.props={pageBg:\"pale blue gray\",pageFg:\"dark gray\",pageBorder:\"shadow\",pageBorderColor:\"dark gray\"}}return i(e,[{key:\"css\",value:function(){return n(\".page\",Object.assign({\"background-color\":t(this.props.pageBg),color:t(this.props.pageFg)},function(e,t){switch(e){case\"none\":return{};case\"shadow\":return{border:\"none\",\"box-shadow\":\"0 4px 8px hsla(0, 0%, 0%, 0.25)\"};case\"thin line\":return{border:\"1px solid ${color(color)}\"};case\"thick line\":return{border:\"4px solid ${color(color)}\"};default:throw new Error('No border style named \"'+e+'\" exists.')}}(this.props.pageBorder,this.pageBorderColor)))}}]),e}(),l={},c=[new s,new u,new a],h=void 0;c.forEach(function(e){Object.keys(e.props).forEach(function(t){Object.defineProperty(l,t,{get:function(){return e.props[t]},set:function(n){e.props[t]=n,h||(h=document.createElement(\"style\"),document.head.appendChild(h)),h.innerHTML=c.reduce(function(e,t){return e+t.css()},\"\")}})})});var f={appearance:l},p={flickr:function(e){return e},unsplash:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"\",n=e.replace(/.*\\//,\"\"),r=document.querySelector(\"div.page\").offsetWidth,i=Math.round(9*r/16);return'<img src=\"https://source.unsplash.com/'+n+\"/\"+r+\"x\"+i+'\" width=\"'+r+'\" height=\"'+i+'\" alt=\"'+t+'\">'}},d=Element.prototype,g=d.matchesSelector||d.webkitMatchesSelector||d.mozMatchesSelector||d.msMatchesSelector||d.oMatchesSelector,y=function(e,t){if(g)return g.call(e,t);for(var n=e.parentNode.querySelectorAll(t),r=0;r<n.length;++r)if(n[r]==e)return!0;return!1};var v=function(e,t,n){for(var r=n?e:e.parentNode;r&&r!==document;){if(y(r,t))return r;r=r.parentNode}},b=\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:{};function m(e,t){return e(t={exports:{}},t.exports),t.exports}var w=1/0,k=\"[object Symbol]\",x=/[&<>\"'`]/g,_=RegExp(x.source),S=\"object\"==typeof b&&b&&b.Object===Object&&b,j=\"object\"==typeof self&&self&&self.Object===Object&&self,O=S||j||Function(\"return this\")();var $,E=($={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#39;\",\"`\":\"&#96;\"},function(e){return null==$?void 0:$[e]}),A=Object.prototype.toString,C=O.Symbol,L=C?C.prototype:void 0,q=L?L.toString:void 0;function T(e){if(\"string\"==typeof e)return e;if(function(e){return\"symbol\"==typeof e||function(e){return!!e&&\"object\"==typeof e}(e)&&A.call(e)==k}(e))return q?q.call(e):\"\";var t=e+\"\";return\"0\"==t&&1/e==-w?\"-0\":t}var I=function(e){var t;return(e=null==(t=e)?\"\":T(t))&&_.test(e)?e.replace(x,E):e},P=\"Expected a function\",z=\"__lodash_hash_undefined__\",F=1/0,M=\"[object Function]\",R=\"[object GeneratorFunction]\",N=\"[object Symbol]\",U=/\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,H=/^\\w*$/,D=/^\\./,B=/[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g,X=/\\\\(\\\\)?/g,Y=/^\\[object .+?Constructor\\]$/,G=\"object\"==typeof b&&b&&b.Object===Object&&b,J=\"object\"==typeof self&&self&&self.Object===Object&&self,W=G||J||Function(\"return this\")();var V,K=Array.prototype,Q=Function.prototype,Z=Object.prototype,ee=W[\"__core-js_shared__\"],te=(V=/[^.]+$/.exec(ee&&ee.keys&&ee.keys.IE_PROTO||\"\"))?\"Symbol(src)_1.\"+V:\"\",ne=Q.toString,re=Z.hasOwnProperty,ie=Z.toString,oe=RegExp(\"^\"+ne.call(re).replace(/[\\\\^$.*+?()[\\]{}|]/g,\"\\\\$&\").replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,\"$1.*?\")+\"$\"),se=W.Symbol,ae=K.splice,ue=me(W,\"Map\"),le=me(Object,\"create\"),ce=se?se.prototype:void 0,he=ce?ce.toString:void 0;function fe(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function pe(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function de(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ge(e,t){for(var n,r,i=e.length;i--;)if((n=e[i][0])===(r=t)||n!=n&&r!=r)return i;return-1}function ye(e,t){for(var n,r=0,i=(t=function(e,t){if(_e(e))return!1;var n=typeof e;if(\"number\"==n||\"symbol\"==n||\"boolean\"==n||null==e||je(e))return!0;return H.test(e)||!U.test(e)||null!=t&&e in Object(t)}(t,e)?[t]:_e(n=t)?n:we(n)).length;null!=e&&r<i;)e=e[ke(t[r++])];return r&&r==i?e:void 0}function ve(e){return!(!Se(e)||te&&te in e)&&(function(e){var t=Se(e)?ie.call(e):\"\";return t==M||t==R}(e)||function(e){var t=!1;if(null!=e&&\"function\"!=typeof e.toString)try{t=!!(e+\"\")}catch(e){}return t}(e)?oe:Y).test(function(e){if(null!=e){try{return ne.call(e)}catch(e){}try{return e+\"\"}catch(e){}}return\"\"}(e))}function be(e,t){var n,r,i=e.__data__;return(\"string\"==(r=typeof(n=t))||\"number\"==r||\"symbol\"==r||\"boolean\"==r?\"__proto__\"!==n:null===n)?i[\"string\"==typeof t?\"string\":\"hash\"]:i.map}function me(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return ve(n)?n:void 0}fe.prototype.clear=function(){this.__data__=le?le(null):{}},fe.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},fe.prototype.get=function(e){var t=this.__data__;if(le){var n=t[e];return n===z?void 0:n}return re.call(t,e)?t[e]:void 0},fe.prototype.has=function(e){var t=this.__data__;return le?void 0!==t[e]:re.call(t,e)},fe.prototype.set=function(e,t){return this.__data__[e]=le&&void 0===t?z:t,this},pe.prototype.clear=function(){this.__data__=[]},pe.prototype.delete=function(e){var t=this.__data__,n=ge(t,e);return!(n<0||(n==t.length-1?t.pop():ae.call(t,n,1),0))},pe.prototype.get=function(e){var t=this.__data__,n=ge(t,e);return n<0?void 0:t[n][1]},pe.prototype.has=function(e){return ge(this.__data__,e)>-1},pe.prototype.set=function(e,t){var n=this.__data__,r=ge(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},de.prototype.clear=function(){this.__data__={hash:new fe,map:new(ue||pe),string:new fe}},de.prototype.delete=function(e){return be(this,e).delete(e)},de.prototype.get=function(e){return be(this,e).get(e)},de.prototype.has=function(e){return be(this,e).has(e)},de.prototype.set=function(e,t){return be(this,e).set(e,t),this};var we=xe(function(e){var t;e=null==(t=e)?\"\":function(e){if(\"string\"==typeof e)return e;if(je(e))return he?he.call(e):\"\";var t=e+\"\";return\"0\"==t&&1/e==-F?\"-0\":t}(t);var n=[];return D.test(e)&&n.push(\"\"),e.replace(B,function(e,t,r,i){n.push(r?i.replace(X,\"$1\"):t||e)}),n});function ke(e){if(\"string\"==typeof e||je(e))return e;var t=e+\"\";return\"0\"==t&&1/e==-F?\"-0\":t}function xe(e,t){if(\"function\"!=typeof e||t&&\"function\"!=typeof t)throw new TypeError(P);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var s=e.apply(this,r);return n.cache=o.set(i,s),s};return n.cache=new(xe.Cache||de),n}xe.Cache=de;var _e=Array.isArray;function Se(e){var t=typeof e;return!!e&&(\"object\"==t||\"function\"==t)}function je(e){return\"symbol\"==typeof e||function(e){return!!e&&\"object\"==typeof e}(e)&&ie.call(e)==N}var Oe=function(e,t,n){var r=null==e?void 0:ye(e,t);return void 0===r?n:r},$e=\"Expected a function\",Ee=\"__lodash_hash_undefined__\",Ae=1/0,Ce=9007199254740991,Le=\"[object Function]\",qe=\"[object GeneratorFunction]\",Te=\"[object Symbol]\",Ie=/\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,Pe=/^\\w*$/,ze=/^\\./,Fe=/[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g,Me=/\\\\(\\\\)?/g,Re=/^\\[object .+?Constructor\\]$/,Ne=/^(?:0|[1-9]\\d*)$/,Ue=\"object\"==typeof b&&b&&b.Object===Object&&b,He=\"object\"==typeof self&&self&&self.Object===Object&&self,De=Ue||He||Function(\"return this\")();var Be=Array.prototype,Xe=Function.prototype,Ye=Object.prototype,Ge=De[\"__core-js_shared__\"],Je=function(){var e=/[^.]+$/.exec(Ge&&Ge.keys&&Ge.keys.IE_PROTO||\"\");return e?\"Symbol(src)_1.\"+e:\"\"}(),We=Xe.toString,Ve=Ye.hasOwnProperty,Ke=Ye.toString,Qe=RegExp(\"^\"+We.call(Ve).replace(/[\\\\^$.*+?()[\\]{}|]/g,\"\\\\$&\").replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,\"$1.*?\")+\"$\"),Ze=De.Symbol,et=Be.splice,tt=pt(De,\"Map\"),nt=pt(Object,\"create\"),rt=Ze?Ze.prototype:void 0,it=rt?rt.toString:void 0;function ot(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function st(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function at(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ut(e,t,n){var r=e[t];Ve.call(e,t)&&bt(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function lt(e,t){for(var n=e.length;n--;)if(bt(e[n][0],t))return n;return-1}function ct(e){return!(!wt(e)||Je&&Je in e)&&(function(e){var t=wt(e)?Ke.call(e):\"\";return t==Le||t==qe}(e)||function(e){var t=!1;if(null!=e&&\"function\"!=typeof e.toString)try{t=!!(e+\"\")}catch(e){}return t}(e)?Qe:Re).test(function(e){if(null!=e){try{return We.call(e)}catch(e){}try{return e+\"\"}catch(e){}}return\"\"}(e))}function ht(e,t,n,r){if(!wt(e))return e;for(var i=-1,o=(t=function(e,t){if(mt(e))return!1;var n=typeof e;if(\"number\"==n||\"symbol\"==n||\"boolean\"==n||null==e||kt(e))return!0;return Pe.test(e)||!Ie.test(e)||null!=t&&e in Object(t)}(t,e)?[t]:function(e){return mt(e)?e:gt(e)}(t)).length,s=o-1,a=e;null!=a&&++i<o;){var u=yt(t[i]),l=n;if(i!=s){var c=a[u];void 0===(l=r?r(c,u,a):void 0)&&(l=wt(c)?c:dt(t[i+1])?[]:{})}ut(a,u,l),a=a[u]}return e}function ft(e,t){var n,r,i=e.__data__;return(\"string\"==(r=typeof(n=t))||\"number\"==r||\"symbol\"==r||\"boolean\"==r?\"__proto__\"!==n:null===n)?i[\"string\"==typeof t?\"string\":\"hash\"]:i.map}function pt(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return ct(n)?n:void 0}function dt(e,t){return!!(t=null==t?Ce:t)&&(\"number\"==typeof e||Ne.test(e))&&e>-1&&e%1==0&&e<t}ot.prototype.clear=function(){this.__data__=nt?nt(null):{}},ot.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},ot.prototype.get=function(e){var t=this.__data__;if(nt){var n=t[e];return n===Ee?void 0:n}return Ve.call(t,e)?t[e]:void 0},ot.prototype.has=function(e){var t=this.__data__;return nt?void 0!==t[e]:Ve.call(t,e)},ot.prototype.set=function(e,t){return this.__data__[e]=nt&&void 0===t?Ee:t,this},st.prototype.clear=function(){this.__data__=[]},st.prototype.delete=function(e){var t=this.__data__,n=lt(t,e);return!(n<0||(n==t.length-1?t.pop():et.call(t,n,1),0))},st.prototype.get=function(e){var t=this.__data__,n=lt(t,e);return n<0?void 0:t[n][1]},st.prototype.has=function(e){return lt(this.__data__,e)>-1},st.prototype.set=function(e,t){var n=this.__data__,r=lt(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},at.prototype.clear=function(){this.__data__={hash:new ot,map:new(tt||st),string:new ot}},at.prototype.delete=function(e){return ft(this,e).delete(e)},at.prototype.get=function(e){return ft(this,e).get(e)},at.prototype.has=function(e){return ft(this,e).has(e)},at.prototype.set=function(e,t){return ft(this,e).set(e,t),this};var gt=vt(function(e){var t;e=null==(t=e)?\"\":function(e){if(\"string\"==typeof e)return e;if(kt(e))return it?it.call(e):\"\";var t=e+\"\";return\"0\"==t&&1/e==-Ae?\"-0\":t}(t);var n=[];return ze.test(e)&&n.push(\"\"),e.replace(Fe,function(e,t,r,i){n.push(r?i.replace(Me,\"$1\"):t||e)}),n});function yt(e){if(\"string\"==typeof e||kt(e))return e;var t=e+\"\";return\"0\"==t&&1/e==-Ae?\"-0\":t}function vt(e,t){if(\"function\"!=typeof e||t&&\"function\"!=typeof t)throw new TypeError($e);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var s=e.apply(this,r);return n.cache=o.set(i,s),s};return n.cache=new(vt.Cache||at),n}function bt(e,t){return e===t||e!=e&&t!=t}vt.Cache=at;var mt=Array.isArray;function wt(e){var t=typeof e;return!!e&&(\"object\"==t||\"function\"==t)}function kt(e){return\"symbol\"==typeof e||function(e){return!!e&&\"object\"==typeof e}(e)&&Ke.call(e)==Te}var xt=function(e,t,n){return null==e?e:ht(e,t,n)},_t={attachTo:function(e){e.addEventListener(\"click\",function(e){var t=v(e.target,\"a[data-cb-save-to][data-cb-cycle]\",!0);if(t){var n=t.dataset.cbSaveTo,r=JSON.parse(t.dataset.cbCycle),i=r.indexOf(t.textContent)+1;i===r.length&&(i=0),xt(window,n,r[i]),t.textContent=r[i]}}),e.addEventListener(\"change\",function(e){var t=v(e.target,\"select[data-cb-save-to]\",!0);if(t){var n=t.dataset.cbSaveTo;xt(window,n,t.options[t.selectedIndex].value)}}),e.addEventListener(\"input\",function(e){var t=v(e.target,'input[type=\"text\"][data-cb-save-to]',!0);if(t){var n=t.dataset.cbSaveTo;xt(window,n,t.value)}})},cyclingLink:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return'<a href=\"javascript:void(0)\" class=\"stationary\" data-cb-save-to=\"'+I(e)+'\" data-cb-cycle=\"'+I(JSON.stringify(n))+'\">'+n[0]+\"</a>\"},menu:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.reduce(function(e,t){return e+'<option value=\"'+t+'\">'+t+\"</option>\"},\"\");return'<select data-cb-save-to=\"'+I(e)+'\">'+i+\"</select>\"},text:function(e){return'<input type=\"text\" value=\"'+I(Oe(window,e))+'\" data-cb-save-to=\"'+I(e)+'\">'}},St=function(){function e(t){r(this,e),this.label=t}return i(e,null,[{key:\"addPassageListener\",value:function(e){e.addEventListener(\"click\",function(e){var t=v(e.target,\"[data-cb-passage]\",!0);if(t){var n=t.dataset.cbPassage;n&&onClick(n)}})}}]),i(e,[{key:\"labelled\",value:function(e){return this.label=e,this}},{key:\"to\",value:function(e){return this.target=e,/^\\w+:\\/\\/\\/?\\w/i.test(e)?this.type=\"url\":this.type=\"passage\",this}},{key:\"restart\",value:function(){return this.type=\"url\",this.target=\"javascript:restart()\",this}},{key:\"toString\",value:function(){switch(this.type){case\"url\":return'<a href=\"'+I(this.target)+'\">'+this.label+\"</a>\";case\"passage\":return'<a href=\"javascript:void(0)\" data-cb-passage=\"'+I(this.target)+'\">'+this.label+\"</a>\";default:throw new Error(\"Don't know how to render links with type \\\"\"+this.type+'\".')}}}]),e}();function jt(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(St,[null].concat(t)))}var Ot=function(e,t,n){let r=0,i=function(e){let t={ms:.001,s:1,m:60,h:3600};return t.d=e.hoursPerDay*t.h,t.w=e.daysPerWeek*t.d,t.mth=e.daysPerYear/e.monthsPerYear*t.d,t.y=e.daysPerYear*t.d,t}(n=Object.assign({},$t,n||{})),o=e.toLowerCase().replace(/[^.\\w+-]+/g,\"\").match(/[-+]?[0-9]+[a-z]+/g);null!==o&&o.forEach(e=>{let t=e.match(/[0-9]+/g)[0],n=e.match(/[a-z]+/g)[0];r+=function(e,t,n){return e*n[At(t)]}(t,n,i)});if(t)return function(e,t,n){return e/n[At(t)]}(r,t,i);return r};const $t={hoursPerDay:24,daysPerWeek:7,weeksPerMonth:4,monthsPerYear:12,daysPerYear:365.25},Et={ms:[\"ms\",\"milli\",\"millisecond\",\"milliseconds\"],s:[\"s\",\"sec\",\"secs\",\"second\",\"seconds\"],m:[\"m\",\"min\",\"mins\",\"minute\",\"minutes\"],h:[\"h\",\"hr\",\"hrs\",\"hour\",\"hours\"],d:[\"d\",\"day\",\"days\"],w:[\"w\",\"week\",\"weeks\"],mth:[\"mon\",\"mth\",\"mths\",\"month\",\"months\"],y:[\"y\",\"yr\",\"yrs\",\"year\",\"years\"]};function At(e){for(let t of Object.keys(Et))if(Et[t].indexOf(e)>-1)return t;throw new Error(`The unit [${e}] is not supported by timestring`)}var Ct=function(){function e(){r(this,e)}return i(e,[{key:\"setup\",value:function(e){this.delay=Ot(e.replace(/^after\\s/i,\"\"),\"ms\")}},{key:\"process\",value:function(e,t){e.text=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=\"<span\"+Object.keys(t).reduce(function(e,n){return e+\" \"+n+'=\"'+t[n]+'\"'},\"\")+\">\";return n+e.replace(/[\\r\\n]{2,}/g,\"</span>$&\"+n)+\"</span>\"}(e.text,{class:\"fade-in\",style:\"animation-delay: \"+this.delay+\"ms\"})}}]),e}();Ct.regexps=[/^after\\s/i];var Lt=function(){function e(){r(this,e)}return i(e,[{key:\"setup\",value:function(){}},{key:\"process\",value:function(e){e.beforeText=\" \"}}]),e}();Lt.regexps=[/^append$/i];var qt=function(){function e(){r(this,e)}return i(e,[{key:\"setup\",value:function(e){this.type=e.replace(/\\s.*/,\"\").toLowerCase(),\"else\"!==this.type&&(this.condition=new Function(\"return \"+e.replace(/.*?\\s/,\"\")))}},{key:\"process\",value:function(e,t){switch(this.type){case\"if\":this.conditionEval=this.condition.apply(window);break;case\"unless\":this.conditionEval=!this.condition.apply(window);break;case\"else\":if(!this.condition)return void t.addError(\"There was no matching if modifier for an else modifier.\");this.conditionEval=!this.conditionEval}this.conditionEval||(e.text=\"\",e.beforeText=\"\",e.afterText=\"\")}}]),e}();qt.regexps=[/^if\\s/i,/^unless\\s/i,/^else$/i];var Tt=function(){function e(){r(this,e)}return i(e,[{key:\"setup\",value:function(){}},{key:\"process\",value:function(){}}]),e}();Tt.regexps=[/^continued$/i,/^continue$/i,/^cont'd$/i,/^cont$/i];var It=function(e){e.addModifier(\"after\",Ct),e.addModifier(\"append\",Lt),e.addModifier(\"conditionals\",qt),e.addModifier(\"continue\",Tt)},Pt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),this.verbose=!1,this.varsSep=/^--$/m,this.modifierPattern=/^\\[([^\\[].+[^\\]])\\]$/gm,Object.assign(this,t)}return i(e,[{key:\"parse\",value:function(e){var t=this,n={vars:{},blocks:[],warnings:[]},r=e.split(this.varsSep,2),i=void 0,s=void 0;if(2===r.length){this.verbose&&console.log(\"vars section detected\");var a=o(r,2);i=a[0],s=a[1],function(e,t){if(\"string\"!=typeof e)throw new TypeError(\"Expected a string in the first argument, got \"+typeof e);if(!t||!t.preserveNewlines)return e.split(/\\r?\\n/);for(var n=e.split(/(\\r?\\n)/),r=[],i=0;i<n.length;i+=2)r.push(n[i]+(n[i+1]||\"\"));return r}(i).forEach(function(e){if(\"\"!==e.trim()){var r=e.indexOf(\":\");if(-1!==r){var i=e.substr(0,r).trim(),o=e.substr(r+1).trim();void 0!==n.vars[i]&&n.warnings.push('The property \"'+i+'\" was defined more than once; using the last value.'),t.verbose&&console.log('Setting prop \"'+i+'\" to \"'+o+'\"'),n.vars[i]=o}else n.warnings.push('The line \"'+e+'\" in the properties section is missing a colon. It was ignored.')}})}else this.verbose&&console.log(\"No vars section detected\"),s=r[0];for(var u=function(e,r){var i=r.trim();\"\"!==i&&(t.verbose&&console.log(\"Creating '\"+e+\"' block with content: \\\"\"+i+'\"'),n.blocks.push({type:e,content:i}))},l=new RegExp(this.modifierPattern),c=0,h=l.exec(s);h;){u(\"text\",s.substring(c,h.index));for(var f=h[1],p=\"\",d=0;d<f.length;d++)switch(f[d]){case'\"':for(p+='\"',d+=1;d<f.length&&(p+=f[d],'\"'!==f[d]||\"\\\\\"===f[d-1]);d++);break;case\";\":u(\"modifier\",p),p=\"\";break;default:p+=f[d]}u(\"modifier\",p),c=l.lastIndex,h=l.exec(s)}return u(\"text\",s.substring(c)),n}}]),e}(),zt=function(){function e(t){r(this,e),this.key=t,this.remembered=[]}return i(e,null,[{key:\"browserEnabled\",value:function(){try{return window.localStorage.setItem(\"chapbook-test\",\"a\"),window.localStorage.removeItem(\"chapbook-test\"),!0}catch(e){return!1}}}]),i(e,[{key:\"remembered\",value:function(e){return-1!==this.remembered.indexOf(e)}},{key:\"remember\",value:function(e){-1===this.remembered.indexOf(e)&&this.remembered.push(e)}},{key:\"save\",value:function(e){try{window.localStorage.setItem(this.key,JSON.stringify({trail:e,vars:this.remembered.reduce(function(e,t){return e[t]=Oe(window,t),e},{})}))}catch(e){throw new Error(\"Could not save the story state (\"+e.message+\").\")}}},{key:\"canRestore\",value:function(){return e.browserEnabled()&&null!==window.localStorage.getItem(this.key)}},{key:\"restore\",value:function(){var e=this;if(this.canRestore()){var t=JSON.parse(window.localStorage.getItem(this.key));return Object.keys(t.vars).forEach(function(n){e.remember(n),xt(window,n,t.vars[n])}),t.trail}return!1}},{key:\"delete\",value:function(){window.localStorage.removeItem(this.key)}}]),e}(),Ft=m(function(e){!function(e,t,n){function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new function(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(\" \"),n.s1=r(\" \"),n.s2=r(\" \"),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}(e),i=t&&t.state,o=n.next;return o.int32=function(){return 4294967296*n.next()|0},o.double=function(){return o()+1.1102230246251565e-16*(2097152*o()|0)},o.quick=o,i&&(\"object\"==typeof i&&r(i,n),o.state=function(){return r(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n(function(){return i}):this.alea=i}(0,e,!1)}),Mt=m(function(e){!function(e,t,n){function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new function(e){var t=this,n=\"\";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&(\"object\"==typeof i&&r(i,n),o.state=function(){return r(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n(function(){return i}):this.xor128=i}(0,e,!1)}),Rt=m(function(e){!function(e,t,n){function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new function(e){var t=this,n=\"\";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&(\"object\"==typeof i&&r(i,n),o.state=function(){return r(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n(function(){return i}):this.xorwow=i}(0,e,!1)}),Nt=m(function(e){!function(e,t,n){function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new function(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],n^=(e^=e<<13)^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=\"\"+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&(i.x&&r(i,n),o.state=function(){return r(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n(function(){return i}):this.xorshift7=i}(0,e,!1)}),Ut=m(function(e){!function(e,t,n){function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new function(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,o=t.i;return t.w=r=r+1640531527|0,n=i[o+34&127],e=i[o=o+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=i[o]=n^e,t.i=o,n+(r^r>>>16)|0},function(e,t){var n,r,i,o,s,a=[],u=128;for(t===(0|t)?(r=t,t=null):(t+=\"\\0\",r=0,u=Math.max(u,t.length)),i=0,o=-32;o<u;++o)t&&(r^=t.charCodeAt((o+32)%t.length)),0===o&&(s=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(s=s+1640531527|0,i=0==(n=a[127&o]^=r+s)?i+1:0);for(i>=128&&(a[127&(t&&t.length||0)]=-1),i=127,o=512;o>0;--o)r=a[i+34&127],n=a[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,a[i]=r^n;e.w=s,e.X=a,e.i=i}(t,e)}(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&(i.X&&r(i,n),o.state=function(){return r(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n(function(){return i}):this.xor4096=i}(0,e,!1)}),Ht=m(function(e){!function(e,t,n){function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new function(e){var t=this,n=\"\";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&(\"object\"==typeof i&&r(i,n),o.state=function(){return r(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n(function(){return i}):this.tychei=i}(0,e,!1)}),Dt={},Bt=Object.freeze({default:Dt}),Xt=Bt&&Dt||Bt,Yt=m(function(e){!function(t,n){var r,i=this,o=256,s=6,a=\"random\",u=n.pow(o,s),l=n.pow(2,52),c=2*l,h=o-1;function f(e,f,y){var v=[],b=d(function e(t,n){var r,i=[],o=typeof t;if(n&&\"object\"==o)for(r in t)try{i.push(e(t[r],n-1))}catch(e){}return i.length?i:\"string\"==o?t:t+\"\\0\"}((f=1==f?{entropy:!0}:f||{}).entropy?[e,g(t)]:null==e?function(){try{var e;return r&&(e=r.randomBytes)?e=e(o):(e=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(e)),g(e)}catch(e){var n=i.navigator,s=n&&n.plugins;return[+new Date,i,s,i.screen,g(t)]}}():e,3),v),m=new function(e){var t,n=e.length,r=this,i=0,s=r.i=r.j=0,a=r.S=[];n||(e=[n++]);for(;i<o;)a[i]=i++;for(i=0;i<o;i++)a[i]=a[s=h&s+e[i%n]+(t=a[i])],a[s]=t;(r.g=function(e){for(var t,n=0,i=r.i,s=r.j,a=r.S;e--;)t=a[i=h&i+1],n=n*o+a[h&(a[i]=a[s=h&s+t])+(a[s]=t)];return r.i=i,r.j=s,n})(o)}(v),w=function(){for(var e=m.g(s),t=u,n=0;e<l;)e=(e+n)*o,t*=o,n=m.g(1);for(;e>=c;)e/=2,t/=2,n>>>=1;return(e+n)/t};return w.int32=function(){return 0|m.g(4)},w.quick=function(){return m.g(4)/4294967296},w.double=w,d(g(m.S),t),(f.pass||y||function(e,t,r,i){return i&&(i.S&&p(i,m),e.state=function(){return p(m,{})}),r?(n[a]=e,t):e})(w,b,\"global\"in f?f.global:this==n,f.state)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function d(e,t){for(var n,r=e+\"\",i=0;i<r.length;)t[h&i]=h&(n^=19*t[h&i])+r.charCodeAt(i++);return g(t)}function g(e){return String.fromCharCode.apply(0,e)}if(n[\"seed\"+a]=f,d(n.random(),t),e.exports){e.exports=f;try{r=Xt}catch(e){}}else 0}([],Math)});Yt.alea=Ft,Yt.xor128=Mt,Yt.xorwow=Rt,Yt.xorshift7=Nt,Yt.xor4096=Ut,Yt.tychei=Ht;var Gt=Yt,Jt=function(){function e(t){r(this,e),this.rng=Gt(t)}return i(e,[{key:\"seed\",value:function(e){this.rng=Gt(e)}},{key:\"coinFlip\",value:function(){return this.rng()>.5}},{key:\"roll\",value:function(e){var t=e.split(/d/i);if(2!==t.length)throw new Error(\"A roll must in the format [number of rolls]d[number of sides], i.e. 1d4.\");var n=parseInt(t[0]);if(isNaN(n))throw new Error(\"The number of rolls specified (\"+t[0]+\") isn't a number.\");var r=parseInt(t[1]);if(isNaN(r))throw new Error(\"The number of die sides specified (\"+t[1]+\") isn't a number.\");for(var i=0,o=0;o<n;o++)i+=1+Math.round(this.rng()*(r-1));return i}},{key:\"choice\",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t[Math.round(this.rng()*(t.length-1))]}}]),e}(),Wt=m(function(e,t){(function(){var t={newline:/^\\n+/,code:/^( {4}[^\\n]+\\n*)+/,fences:c,hr:/^( *[-*_]){3,} *(?:\\n+|$)/,heading:/^ *(#{1,6}) *([^\\n]+?) *#* *(?:\\n+|$)/,nptable:c,lheading:/^([^\\n]+)\\n *(=|-){2,} *(?:\\n+|$)/,blockquote:/^( *>[^\\n]+(\\n(?!def)[^\\n]+)*\\n*)+/,list:/^( *)(bull) [\\s\\S]+?(?:hr|def|\\n{2,}(?! )(?!\\1bull )\\n*|\\s*$)/,html:/^ *(?:comment *(?:\\n|\\s*$)|closed *(?:\\n{2,}|\\s*$)|closing *(?:\\n{2,}|\\s*$))/,def:/^ *\\[([^\\]]+)\\]: *<?([^\\s>]+)>?(?: +[\"(]([^\\n]+)[\")])? *(?:\\n+|$)/,table:c,paragraph:/^((?:[^\\n]+\\n?(?!hr|heading|lheading|blockquote|tag|def))+)\\n*/,text:/^[^\\n]+/};function n(e){this.tokens=[],this.tokens.links={},this.options=e||f.defaults,this.rules=t.normal,this.options.gfm&&(this.options.tables?this.rules=t.tables:this.rules=t.gfm)}t.bullet=/(?:[*+-]|\\d+\\.)/,t.item=/^( *)(bull) [^\\n]*(?:\\n(?!\\1bull )[^\\n]*)*/,t.item=u(t.item,\"gm\")(/bull/g,t.bullet)(),t.list=u(t.list)(/bull/g,t.bullet)(\"hr\",\"\\\\n+(?=\\\\1?(?:[-*_] *){3,}(?:\\\\n+|$))\")(\"def\",\"\\\\n+(?=\"+t.def.source+\")\")(),t._tag=\"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\\\b)\\\\w+(?!:/|[^\\\\w\\\\s@]*@)\\\\b\",t.html=u(t.html)(\"comment\",/<!--[\\s\\S]*?-->/)(\"closed\",/<(tag)[\\s\\S]+?<\\/\\1>/)(\"closing\",/<tag(?:\"[^\"]*\"|'[^']*'|[^'\">])*?>/)(/tag/g,t._tag)(),t.paragraph=u(t.paragraph)(\"hr\",t.hr)(\"heading\",t.heading)(\"lheading\",t.lheading)(\"blockquote\",t.blockquote)(\"tag\",\"<\"+t._tag)(\"def\",t.def)(),t.normal=h({},t),t.gfm=h({},t.normal,{fences:/^ *(`{3,}|~{3,})[ \\.]*(\\S+)? *\\n([\\s\\S]*?)\\s*\\1 *(?:\\n+|$)/,paragraph:/^/,heading:/^ *(#{1,6}) +([^\\n]+?) *#* *(?:\\n+|$)/}),t.gfm.paragraph=u(t.paragraph)(\"(?!\",\"(?!\"+t.gfm.fences.source.replace(\"\\\\1\",\"\\\\2\")+\"|\"+t.list.source.replace(\"\\\\1\",\"\\\\3\")+\"|\")(),t.tables=h({},t.gfm,{nptable:/^ *(\\S.*\\|.*)\\n *([-:]+ *\\|[-| :]*)\\n((?:.*\\|.*(?:\\n|$))*)\\n*/,table:/^ *\\|(.+)\\n *\\|( *[-:]+[-| :]*)\\n((?: *\\|.*(?:\\n|$))*)\\n*/}),n.rules=t,n.lex=function(e,t){return new n(t).lex(e)},n.prototype.lex=function(e){return e=e.replace(/\\r\\n|\\r/g,\"\\n\").replace(/\\t/g,\"    \").replace(/\\u00a0/g,\" \").replace(/\\u2424/g,\"\\n\"),this.token(e,!0)},n.prototype.token=function(e,n,r){var i,o,s,a,u,l,c,h,f;for(e=e.replace(/^ +$/gm,\"\");e;)if((s=this.rules.newline.exec(e))&&(e=e.substring(s[0].length),s[0].length>1&&this.tokens.push({type:\"space\"})),s=this.rules.code.exec(e))e=e.substring(s[0].length),s=s[0].replace(/^ {4}/gm,\"\"),this.tokens.push({type:\"code\",text:this.options.pedantic?s:s.replace(/\\n+$/,\"\")});else if(s=this.rules.fences.exec(e))e=e.substring(s[0].length),this.tokens.push({type:\"code\",lang:s[2],text:s[3]||\"\"});else if(s=this.rules.heading.exec(e))e=e.substring(s[0].length),this.tokens.push({type:\"heading\",depth:s[1].length,text:s[2]});else if(n&&(s=this.rules.nptable.exec(e))){for(e=e.substring(s[0].length),l={type:\"table\",header:s[1].replace(/^ *| *\\| *$/g,\"\").split(/ *\\| */),align:s[2].replace(/^ *|\\| *$/g,\"\").split(/ *\\| */),cells:s[3].replace(/\\n$/,\"\").split(\"\\n\")},h=0;h<l.align.length;h++)/^ *-+: *$/.test(l.align[h])?l.align[h]=\"right\":/^ *:-+: *$/.test(l.align[h])?l.align[h]=\"center\":/^ *:-+ *$/.test(l.align[h])?l.align[h]=\"left\":l.align[h]=null;for(h=0;h<l.cells.length;h++)l.cells[h]=l.cells[h].split(/ *\\| */);this.tokens.push(l)}else if(s=this.rules.lheading.exec(e))e=e.substring(s[0].length),this.tokens.push({type:\"heading\",depth:\"=\"===s[2]?1:2,text:s[1]});else if(s=this.rules.hr.exec(e))e=e.substring(s[0].length),this.tokens.push({type:\"hr\"});else if(s=this.rules.blockquote.exec(e))e=e.substring(s[0].length),this.tokens.push({type:\"blockquote_start\"}),s=s[0].replace(/^ *> ?/gm,\"\"),this.token(s,n,!0),this.tokens.push({type:\"blockquote_end\"});else if(s=this.rules.list.exec(e)){for(e=e.substring(s[0].length),a=s[2],this.tokens.push({type:\"list_start\",ordered:a.length>1}),i=!1,f=(s=s[0].match(this.rules.item)).length,h=0;h<f;h++)c=(l=s[h]).length,~(l=l.replace(/^ *([*+-]|\\d+\\.) +/,\"\")).indexOf(\"\\n \")&&(c-=l.length,l=this.options.pedantic?l.replace(/^ {1,4}/gm,\"\"):l.replace(new RegExp(\"^ {1,\"+c+\"}\",\"gm\"),\"\")),this.options.smartLists&&h!==f-1&&(a===(u=t.bullet.exec(s[h+1])[0])||a.length>1&&u.length>1||(e=s.slice(h+1).join(\"\\n\")+e,h=f-1)),o=i||/\\n\\n(?!\\s*$)/.test(l),h!==f-1&&(i=\"\\n\"===l.charAt(l.length-1),o||(o=i)),this.tokens.push({type:o?\"loose_item_start\":\"list_item_start\"}),this.token(l,!1,r),this.tokens.push({type:\"list_item_end\"});this.tokens.push({type:\"list_end\"})}else if(s=this.rules.html.exec(e))e=e.substring(s[0].length),this.tokens.push({type:this.options.sanitize?\"paragraph\":\"html\",pre:!this.options.sanitizer&&(\"pre\"===s[1]||\"script\"===s[1]||\"style\"===s[1]),text:s[0]});else if(!r&&n&&(s=this.rules.def.exec(e)))e=e.substring(s[0].length),this.tokens.links[s[1].toLowerCase()]={href:s[2],title:s[3]};else if(n&&(s=this.rules.table.exec(e))){for(e=e.substring(s[0].length),l={type:\"table\",header:s[1].replace(/^ *| *\\| *$/g,\"\").split(/ *\\| */),align:s[2].replace(/^ *|\\| *$/g,\"\").split(/ *\\| */),cells:s[3].replace(/(?: *\\| *)?\\n$/,\"\").split(\"\\n\")},h=0;h<l.align.length;h++)/^ *-+: *$/.test(l.align[h])?l.align[h]=\"right\":/^ *:-+: *$/.test(l.align[h])?l.align[h]=\"center\":/^ *:-+ *$/.test(l.align[h])?l.align[h]=\"left\":l.align[h]=null;for(h=0;h<l.cells.length;h++)l.cells[h]=l.cells[h].replace(/^ *\\| *| *\\| *$/g,\"\").split(/ *\\| */);this.tokens.push(l)}else if(n&&(s=this.rules.paragraph.exec(e)))e=e.substring(s[0].length),this.tokens.push({type:\"paragraph\",text:\"\\n\"===s[1].charAt(s[1].length-1)?s[1].slice(0,-1):s[1]});else if(s=this.rules.text.exec(e))e=e.substring(s[0].length),this.tokens.push({type:\"text\",text:s[0]});else if(e)throw new Error(\"Infinite loop on byte: \"+e.charCodeAt(0));return this.tokens};var r={escape:/^\\\\([\\\\`*{}\\[\\]()#+\\-.!_>])/,autolink:/^<([^ >]+(@|:\\/)[^ >]+)>/,url:c,tag:/^<!--[\\s\\S]*?-->|^<\\/?\\w+(?:\"[^\"]*\"|'[^']*'|[^'\">])*?>/,link:/^!?\\[(inside)\\]\\(href\\)/,reflink:/^!?\\[(inside)\\]\\s*\\[([^\\]]*)\\]/,nolink:/^!?\\[((?:\\[[^\\]]*\\]|[^\\[\\]])*)\\]/,strong:/^__([\\s\\S]+?)__(?!_)|^\\*\\*([\\s\\S]+?)\\*\\*(?!\\*)/,em:/^\\b_((?:[^_]|__)+?)_\\b|^\\*((?:\\*\\*|[\\s\\S])+?)\\*(?!\\*)/,code:/^(`+)([\\s\\S]*?[^`])\\1(?!`)/,br:/^ {2,}\\n(?!\\s*$)/,del:c,text:/^[\\s\\S]+?(?=[\\\\<!\\[_*`]| {2,}\\n|$)/};function i(e,t){if(this.options=t||f.defaults,this.links=e,this.rules=r.normal,this.renderer=this.options.renderer||new o,this.renderer.options=this.options,!this.links)throw new Error(\"Tokens array requires a `links` property.\");this.options.gfm?this.options.breaks?this.rules=r.breaks:this.rules=r.gfm:this.options.pedantic&&(this.rules=r.pedantic)}function o(e){this.options=e||{}}function s(e){this.tokens=[],this.token=null,this.options=e||f.defaults,this.options.renderer=this.options.renderer||new o,this.renderer=this.options.renderer,this.renderer.options=this.options}function a(e,t){return e.replace(t?/&/g:/&(?!#?\\w+;)/g,\"&amp;\").replace(/</g,\"&lt;\").replace(/>/g,\"&gt;\").replace(/\"/g,\"&quot;\").replace(/'/g,\"&#39;\")}function u(e,t){return e=e.source,t=t||\"\",function n(r,i){return r?(i=(i=i.source||i).replace(/(^|[^\\[])\\^/g,\"$1\"),e=e.replace(r,i),n):new RegExp(e,t)}}function l(e,t){return baseUrls[\" \"+e]||(/^[^:]+:\\/*[^/]*$/.test(e)?baseUrls[\" \"+e]=e+\"/\":baseUrls[\" \"+e]=e.replace(/[^/]*$/,\"\")),e=baseUrls[\" \"+e],\"//\"===t.slice(0,2)?e.replace(/:[^]*/,\":\")+t:\"/\"===t.charAt(0)?e.replace(/(:\\/*[^/]*)[^]*/,\"$1\")+t:e+t}function c(){}function h(e){for(var t,n,r=1;r<arguments.length;r++)for(n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}function f(e,t,r){if(r||\"function\"==typeof t){r||(r=t,t=null);var i,o,u=(t=h({},f.defaults,t||{})).highlight,l=0;try{i=n.lex(e,t)}catch(e){return r(e)}o=i.length;var c=function(e){if(e)return t.highlight=u,r(e);var n;try{n=s.parse(i,t)}catch(t){e=t}return t.highlight=u,e?r(e):r(null,n)};if(!u||u.length<3)return c();if(delete t.highlight,!o)return c();for(;l<i.length;l++)!function(e){\"code\"!==e.type?--o||c():u(e.text,e.lang,function(t,n){return t?c(t):null==n||n===e.text?--o||c():(e.text=n,e.escaped=!0,void(--o||c()))})}(i[l])}else try{return t&&(t=h({},f.defaults,t)),s.parse(n.lex(e,t),t)}catch(e){if(e.message+=\"\\nPlease report this to https://github.com/chjj/marked.\",(t||f.defaults).silent)return\"<p>An error occured:</p><pre>\"+a(e.message+\"\",!0)+\"</pre>\";throw e}}r._inside=/(?:\\[[^\\]]*\\]|[^\\[\\]]|\\](?=[^\\[]*\\]))*/,r._href=/\\s*<?([\\s\\S]*?)>?(?:\\s+['\"]([\\s\\S]*?)['\"])?\\s*/,r.link=u(r.link)(\"inside\",r._inside)(\"href\",r._href)(),r.reflink=u(r.reflink)(\"inside\",r._inside)(),r.normal=h({},r),r.pedantic=h({},r.normal,{strong:/^__(?=\\S)([\\s\\S]*?\\S)__(?!_)|^\\*\\*(?=\\S)([\\s\\S]*?\\S)\\*\\*(?!\\*)/,em:/^_(?=\\S)([\\s\\S]*?\\S)_(?!_)|^\\*(?=\\S)([\\s\\S]*?\\S)\\*(?!\\*)/}),r.gfm=h({},r.normal,{escape:u(r.escape)(\"])\",\"~|])\")(),url:/^(https?:\\/\\/[^\\s<]+[^<.,:;\"')\\]\\s])/,del:/^~~(?=\\S)([\\s\\S]*?\\S)~~/,text:u(r.text)(\"]|\",\"~]|\")(\"|\",\"|https?://|\")()}),r.breaks=h({},r.gfm,{br:u(r.br)(\"{2,}\",\"*\")(),text:u(r.gfm.text)(\"{2,}\",\"*\")()}),i.rules=r,i.output=function(e,t,n){return new i(t,n).output(e)},i.prototype.output=function(e){for(var t,n,r,i,o=\"\";e;)if(i=this.rules.escape.exec(e))e=e.substring(i[0].length),o+=i[1];else if(i=this.rules.autolink.exec(e))e=e.substring(i[0].length),\"@\"===i[2]?(n=a(\":\"===i[1].charAt(6)?this.mangle(i[1].substring(7)):this.mangle(i[1])),r=this.mangle(\"mailto:\")+n):r=n=a(i[1]),o+=this.renderer.link(r,null,n);else if(this.inLink||!(i=this.rules.url.exec(e))){if(i=this.rules.tag.exec(e))!this.inLink&&/^<a /i.test(i[0])?this.inLink=!0:this.inLink&&/^<\\/a>/i.test(i[0])&&(this.inLink=!1),e=e.substring(i[0].length),o+=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(i[0]):a(i[0]):i[0];else if(i=this.rules.link.exec(e))e=e.substring(i[0].length),this.inLink=!0,o+=this.outputLink(i,{href:i[2],title:i[3]}),this.inLink=!1;else if((i=this.rules.reflink.exec(e))||(i=this.rules.nolink.exec(e))){if(e=e.substring(i[0].length),t=(i[2]||i[1]).replace(/\\s+/g,\" \"),!(t=this.links[t.toLowerCase()])||!t.href){o+=i[0].charAt(0),e=i[0].substring(1)+e;continue}this.inLink=!0,o+=this.outputLink(i,t),this.inLink=!1}else if(i=this.rules.strong.exec(e))e=e.substring(i[0].length),o+=this.renderer.strong(this.output(i[2]||i[1]));else if(i=this.rules.em.exec(e))e=e.substring(i[0].length),o+=this.renderer.em(this.output(i[2]||i[1]));else if(i=this.rules.code.exec(e))e=e.substring(i[0].length),o+=this.renderer.codespan(a(i[2].trim(),!0));else if(i=this.rules.br.exec(e))e=e.substring(i[0].length),o+=this.renderer.br();else if(i=this.rules.del.exec(e))e=e.substring(i[0].length),o+=this.renderer.del(this.output(i[1]));else if(i=this.rules.text.exec(e))e=e.substring(i[0].length),o+=this.renderer.text(a(this.smartypants(i[0])));else if(e)throw new Error(\"Infinite loop on byte: \"+e.charCodeAt(0))}else e=e.substring(i[0].length),r=n=a(i[1]),o+=this.renderer.link(r,null,n);return o},i.prototype.outputLink=function(e,t){var n=a(t.href),r=t.title?a(t.title):null;return\"!\"!==e[0].charAt(0)?this.renderer.link(n,r,this.output(e[1])):this.renderer.image(n,r,a(e[1]))},i.prototype.smartypants=function(e){return this.options.smartypants?e.replace(/---/g,\"—\").replace(/--/g,\"–\").replace(/(^|[-\\u2014/(\\[{\"\\s])'/g,\"$1‘\").replace(/'/g,\"’\").replace(/(^|[-\\u2014/(\\[{\\u2018\\s])\"/g,\"$1“\").replace(/\"/g,\"”\").replace(/\\.{3}/g,\"…\"):e},i.prototype.mangle=function(e){if(!this.options.mangle)return e;for(var t,n=\"\",r=e.length,i=0;i<r;i++)t=e.charCodeAt(i),Math.random()>.5&&(t=\"x\"+t.toString(16)),n+=\"&#\"+t+\";\";return n},o.prototype.code=function(e,t,n){if(this.options.highlight){var r=this.options.highlight(e,t);null!=r&&r!==e&&(n=!0,e=r)}return t?'<pre><code class=\"'+this.options.langPrefix+a(t,!0)+'\">'+(n?e:a(e,!0))+\"\\n</code></pre>\\n\":\"<pre><code>\"+(n?e:a(e,!0))+\"\\n</code></pre>\"},o.prototype.blockquote=function(e){return\"<blockquote>\\n\"+e+\"</blockquote>\\n\"},o.prototype.html=function(e){return e},o.prototype.heading=function(e,t,n){return\"<h\"+t+' id=\"'+this.options.headerPrefix+n.toLowerCase().replace(/[^\\w]+/g,\"-\")+'\">'+e+\"</h\"+t+\">\\n\"},o.prototype.hr=function(){return this.options.xhtml?\"<hr/>\\n\":\"<hr>\\n\"},o.prototype.list=function(e,t){var n=t?\"ol\":\"ul\";return\"<\"+n+\">\\n\"+e+\"</\"+n+\">\\n\"},o.prototype.listitem=function(e){return\"<li>\"+e+\"</li>\\n\"},o.prototype.paragraph=function(e){return\"<p>\"+e+\"</p>\\n\"},o.prototype.table=function(e,t){return\"<table>\\n<thead>\\n\"+e+\"</thead>\\n<tbody>\\n\"+t+\"</tbody>\\n</table>\\n\"},o.prototype.tablerow=function(e){return\"<tr>\\n\"+e+\"</tr>\\n\"},o.prototype.tablecell=function(e,t){var n=t.header?\"th\":\"td\";return(t.align?\"<\"+n+' style=\"text-align:'+t.align+'\">':\"<\"+n+\">\")+e+\"</\"+n+\">\\n\"},o.prototype.strong=function(e){return\"<strong>\"+e+\"</strong>\"},o.prototype.em=function(e){return\"<em>\"+e+\"</em>\"},o.prototype.codespan=function(e){return\"<code>\"+e+\"</code>\"},o.prototype.br=function(){return this.options.xhtml?\"<br/>\":\"<br>\"},o.prototype.del=function(e){return\"<del>\"+e+\"</del>\"},o.prototype.link=function(e,t,n){if(this.options.sanitize){try{var r=decodeURIComponent((i=e,i.replace(/&(#(?:\\d+)|(?:#x[0-9A-Fa-f]+)|(?:\\w+));?/gi,function(e,t){return\"colon\"===(t=t.toLowerCase())?\":\":\"#\"===t.charAt(0)?\"x\"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):\"\"}))).replace(/[^\\w:]/g,\"\").toLowerCase()}catch(e){return\"\"}if(0===r.indexOf(\"javascript:\")||0===r.indexOf(\"vbscript:\")||0===r.indexOf(\"data:\"))return\"\"}var i;this.options.baseUrl&&!originIndependentUrl.test(e)&&(e=l(this.options.baseUrl,e));var o='<a href=\"'+e+'\"';return t&&(o+=' title=\"'+t+'\"'),o+=\">\"+n+\"</a>\"},o.prototype.image=function(e,t,n){this.options.baseUrl&&!originIndependentUrl.test(e)&&(e=l(this.options.baseUrl,e));var r='<img src=\"'+e+'\" alt=\"'+n+'\"';return t&&(r+=' title=\"'+t+'\"'),r+=this.options.xhtml?\"/>\":\">\"},o.prototype.text=function(e){return e},s.parse=function(e,t,n){return new s(t,n).parse(e)},s.prototype.parse=function(e){this.inline=new i(e.links,this.options,this.renderer),this.tokens=e.reverse();for(var t=\"\";this.next();)t+=this.tok();return t},s.prototype.next=function(){return this.token=this.tokens.pop()},s.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},s.prototype.parseText=function(){for(var e=this.token.text;\"text\"===this.peek().type;)e+=\"\\n\"+this.next().text;return this.inline.output(e)},s.prototype.tok=function(){switch(this.token.type){case\"space\":return\"\";case\"hr\":return this.renderer.hr();case\"heading\":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,this.token.text);case\"code\":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case\"table\":var e,t,n,r,i=\"\",o=\"\";for(n=\"\",e=0;e<this.token.header.length;e++)({header:!0,align:this.token.align[e]}),n+=this.renderer.tablecell(this.inline.output(this.token.header[e]),{header:!0,align:this.token.align[e]});for(i+=this.renderer.tablerow(n),e=0;e<this.token.cells.length;e++){for(t=this.token.cells[e],n=\"\",r=0;r<t.length;r++)n+=this.renderer.tablecell(this.inline.output(t[r]),{header:!1,align:this.token.align[r]});o+=this.renderer.tablerow(n)}return this.renderer.table(i,o);case\"blockquote_start\":for(o=\"\";\"blockquote_end\"!==this.next().type;)o+=this.tok();return this.renderer.blockquote(o);case\"list_start\":o=\"\";for(var s=this.token.ordered;\"list_end\"!==this.next().type;)o+=this.tok();return this.renderer.list(o,s);case\"list_item_start\":for(o=\"\";\"list_item_end\"!==this.next().type;)o+=\"text\"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(o);case\"loose_item_start\":for(o=\"\";\"list_item_end\"!==this.next().type;)o+=this.tok();return this.renderer.listitem(o);case\"html\":var a=this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);return this.renderer.html(a);case\"paragraph\":return this.renderer.paragraph(this.inline.output(this.token.text));case\"text\":return this.renderer.paragraph(this.parseText())}},baseUrls={},originIndependentUrl=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i,c.exec=c,f.options=f.setOptions=function(e){return h(f.defaults,e),f},f.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,sanitizer:null,mangle:!0,smartLists:!1,silent:!1,highlight:null,langPrefix:\"lang-\",smartypants:!1,headerPrefix:\"\",renderer:new o,xhtml:!1,baseUrl:null},f.Parser=s,f.parser=s.parse,f.Renderer=o,f.Lexer=n,f.lexer=n.lex,f.InlineLexer=i,f.inlineLexer=i.output,f.parse=f,e.exports=f}).call(function(){return this||(\"undefined\"!=typeof window?window:b)}())}),Vt=1/0,Kt=\"[object Symbol]\",Qt=/&(?:amp|lt|gt|quot|#39|#96);/g,Zt=RegExp(Qt.source),en=\"object\"==typeof b&&b&&b.Object===Object&&b,tn=\"object\"==typeof self&&self&&self.Object===Object&&self,nn=en||tn||Function(\"return this\")();var rn=function(e){return function(t){return null==e?void 0:e[t]}}({\"&amp;\":\"&\",\"&lt;\":\"<\",\"&gt;\":\">\",\"&quot;\":'\"',\"&#39;\":\"'\",\"&#96;\":\"`\"}),on=Object.prototype.toString,sn=nn.Symbol,an=sn?sn.prototype:void 0,un=an?an.toString:void 0;function ln(e){if(\"string\"==typeof e)return e;if(function(e){return\"symbol\"==typeof e||function(e){return!!e&&\"object\"==typeof e}(e)&&on.call(e)==Kt}(e))return un?un.call(e):\"\";var t=e+\"\";return\"0\"==t&&1/e==-Vt?\"-0\":t}var cn=function(e){var t;return(e=null==(t=e)?\"\":ln(t))&&Zt.test(e)?e.replace(Qt,rn):e},hn=new Wt.Renderer;hn.code=function(e){return new Function(cn(e)).apply(window),\"\"},hn.codespan=function(e){var t=new Function(\"return (\"+cn(e)+\")\").apply(window);if(null!==t&&void 0!==t)return t.toString()},hn.del=function(e){return'<span class=\"small-caps\">'+e+\"</span>\"};var fn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),this.verbose=!1,this.modifiers=[],this.markedOptions={renderer:hn,smartypants:!0},Object.assign(this,t)}return i(e,[{key:\"addModifier\",value:function(e,t){var n=this;if(this.modifiers.some(function(t){return t.name===e}))throw new Error('A modifier named \"'+e+'\" has already been added to this renderer');if(!t.regexps||!t.regexps.length)throw new Error(\"A modifier must have a static regexps property\");t.regexps.forEach(function(r){return n.modifiers.push({name:e,regexp:r,modifier:t})})}},{key:\"removeModifier\",value:function(e){var t=this.modifiers.length;if(this.modifiers=this.modifiers.filter(function(t){return t.name!==e}),this.modifiers.length===t)throw new Error('A modifier named \"'+e+'\" does not exist in this renderer')}},{key:\"toHtml\",value:function(e){return Wt.setOptions(this.markedOptions),Wt(e)}},{key:\"render\",value:function(e){var t=this,n={markdown:\"\",html:\"\",warnings:e.warnings||[],errors:e.errors||[]};e.vars?(this.verbose&&console.log(\"Setting vars...\",e.vars),Object.keys(e.vars).forEach(function(n){t.verbose&&console.log('Setting var \"'+n+'\"'),xt(window,n,new Function(\"return \"+e.vars[n])())})):console.warn(\"Renderer was given an object with no vars\");var r=[],i={},o={addWarning:function(e){n.warnings.push(e)},addError:function(e){n.errors.push(e)}};return e.blocks?e.blocks.forEach(function(e){switch(e.type){case\"text\":var s={text:(l=e.content,c=l,c=c.replace(/\\[\\[(.*?)\\]\\]/g,function(e,t){var n=t,r=t.indexOf(\"|\");if(-1!==r)n=t.substr(0,r),t=t.substr(r+1);else{var i=t.indexOf(\"->\");if(-1!==i)n=t.substr(0,i),t=t.substr(i+2);else{var o=t.indexOf(\"<-\");-1!==o&&(n=t.substr(o+2),t=t.substr(0,o))}}return new St(n).to(t).toString()})),beforeText:\"\\n\\n\",afterText:\"\"};t.verbose?(console.log(\"Running \"+r.length+\" modifiers on text block...\"),r.forEach(function(e){e.process(s,o),console.table(s)})):r.forEach(function(e){return e.process(s,o)}),n.markdown+=s.beforeText+s.text+s.afterText,r=[],t.verbose&&(console.log(\"Output after modifiers:\"),console.table(s));break;case\"modifier\":var a=t.modifiers.filter(function(t){return t.regexp.test(e.content)});if(1===a.length){var u=a[0];t.verbose&&console.log('Activated \"'+u.name+'\" modifier matching ['+e.content+\"]\"),i[u.name]||(t.verbose&&console.log('Creating new instance of \"'+u.name+'\" modifier'),i[u.name]=new u.modifier),i[u.name].setup(e.content),r.push(i[u.name])}else 0===a.length?n.warnings.push('No modifiers matched \"['+e.content+']\". It was ignored.'):n.warnings.push('More than one modifier matched \"['+e.content+']\". It was ignored.');break;default:throw new Error(\"Don't know how to render a block with type \\\"\"+e.type+'\".')}var l,c}):console.warn(\"Renderer was given an object with no blocks\"),n.html=this.toHtml(n.markdown),n}}]),e}(),pn=[\"left\",\"center\",\"right\"],dn=function(){function e(t,n){var i=this;r(this,e),this.el=t,this.render=n,pn.forEach(function(e){var t=document.createElement(\"span\");t.className=e,i.el.appendChild(t),i[e+\"El\"]=t,i[e]=\"\"})}return i(e,[{key:\"update\",value:function(){var e=this,t=!1;pn.forEach(function(n){var r=e.render(e[n]);e[n+\"El\"].innerHTML=r,r&&(t=!0)}),t?this.el.classList.add(\"has-content\"):this.el.classList.remove(\"has-content\")}}]),e}(),gn=function(){function e(){r(this,e),this.tags=[]}return i(e,[{key:\"loadFromHtml\",value:function(e){var t=e.getAttribute(\"tags\");this.name=e.getAttribute(\"name\"),this.id=parseInt(e.getAttribute(\"pid\")),t&&(this.tags=t.split(\" \")),this.source=e.textContent}}]),e}(),yn=function(){function e(t,n,i){r(this,e),this.view=t,this.parser=n,this.renderer=i,this.passages=[],this.customScripts=[],this.customStyles=[]}return i(e,[{key:\"loadFromHtml\",value:function(e){var t=this;[\"name\",\"creator\",\"ifid\"].forEach(function(n){return t[n]=e.getAttribute(n)}),this.startNode=parseInt(e.getAttribute(\"startnode\")),this.creatorVersion=e.getAttribute(\"creator-version\");var n=function(e){return Array.from(e).map(function(e){return e.textContent})};this.customScripts=n(e.querySelectorAll('[type=\"text/twine-javascript\"]')),this.customStyles=n(e.querySelectorAll('[type=\"text/twine-css\"]')),this.passages=Array.from(e.querySelectorAll(\"tw-passagedata\")).map(function(e){var t=new gn;return t.loadFromHtml(e),t})}},{key:\"passage\",value:function(e){return this.passages.find(function(t){return t.name===e})}}]),e}(),vn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];r(this,e),this.passages=t}return i(e,[{key:\"add\",value:function(e){this.passages.push(e)}},{key:\"clear\",value:function(){this.passages=[]}},{key:\"toString\",value:function(){return this.passages.toString()}},{key:\"length\",get:function(){return this.passages.length}},{key:\"last\",get:function(){return this.passages[this.passages.length-1]}}]),e}(),bn=function(){function e(t){r(this,e),this.el=t}return i(e,[{key:\"show\",value:function(e){this.el.innerHTML=e}}]),e}(),mn={init:function(){mn.parser=new Pt,mn.renderer=new fn,It(mn.renderer),mn.view=new bn(document.querySelector(\".page article\")),attachPassageLinks(mn.view.el,mn.go),mn.story=new yn,mn.story.loadFromHtml(document.querySelector(\"tw-storydata\")),mn.config=f,mn.header=new dn(document.querySelector(\".page header\"),mn.render),mn.footer=new dn(document.querySelector(\".page footer\"),mn.render),mn.footer.left=\"_`story.name`_\",mn.footer.right=\"`link('Restart').restart()`\",mn.image=p,mn.link=jt,St.addPassageListener(mn.view.el),mn.input=_t,mn.random=new Jt,Object.assign(window,mn),mn.persistence=new zt(mn.story.name),mn.persistence.canRestore()?mn.trail=new vn(mn.persistence.restore()):mn.trail=new vn,mn.trail.length>0?(mn.view.show(mn.show(mn.trail.last)),mn.persistence.save(mn.trail.passages)):mn.restart(),mn.header.update(),mn.footer.update()},render:function(e){var t=mn.parser.parse(e),n=mn.renderer.render(t);return Object.keys(t.vars).forEach(function(e){return mn.persistence.remember(e)}),n.html},show:function(e){var t=mn.story.passage(e);if(!t)throw new Error('There is no passage named \"'+e+'\".');return mn.render(t.source)},go:function(e){mn.trail.add(e),mn.view.show(mn.show(e)),mn.persistence.save(mn.trail.passages),mn.header.update(),mn.footer.update()},restart:function(){var e=mn.story.passages.find(function(e){return e.id===mn.story.startNode});if(!e)throw new Error(\"There is no passsage with the ID \"+Global.story.startNode+\".\");mn.persistence.delete(),mn.trail.clear(),mn.go(e.name)}};mn.init()}();</script></body></html>","version":"1.0.0"});