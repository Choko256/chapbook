window.storyFormat({"author":"Chris Klimas","name":"Chapbook","proofing":false,"source":"<!DOCTYPE html>\n<html>\n\t<head>\n\t\t<title>{{STORY_NAME}}</title>\n\t\t<meta charset=\"utf-8\">\n\t\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\t\t<style>*{box-sizing:border-box}body{font-family:Georgia,serif;font-size:20px;color:#2e3436;background:#eceff1;margin:0;display:flex;flex-direction:column;justify-content:center;align-items:center;transition:background-color 1s ease-in-out}a{color:#050505;text-decoration-color:#e91e63}a:hover{color:#e91e63}tw-storydata{display:none}.page{width:35em;max-width:calc(100vw - 2em);line-height:150%;min-height:calc(100vh - 2em);margin:1em;padding:2em;display:flex;flex-direction:column;justify-content:center;background:#fff;box-shadow:0 4px 8px rgba(0,0,0,.25)}.page :first-child{margin-top:0}</style>\n\t</head>\n\t<body>\n\t\t<div class=\"page\" aria-live=\"polite\"></div>\n\t\t{{STORY_DATA}}\n\t\t<script>(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n(function (global){\nvar INFINITY=1/0,symbolTag=\"[object Symbol]\",reUnescapedHtml=/[&<>\"'`]/g,reHasUnescapedHtml=RegExp(reUnescapedHtml.source),htmlEscapes={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#39;\",\"`\":\"&#96;\"},freeGlobal=\"object\"==typeof global&&global&&global.Object===Object&&global,freeSelf=\"object\"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function(\"return this\")();function basePropertyOf(e){return function(t){return null==e?void 0:e[t]}}var escapeHtmlChar=basePropertyOf(htmlEscapes),objectProto=Object.prototype,objectToString=objectProto.toString,Symbol=root.Symbol,symbolProto=Symbol?Symbol.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;function baseToString(e){if(\"string\"==typeof e)return e;if(isSymbol(e))return symbolToString?symbolToString.call(e):\"\";var t=e+\"\";return\"0\"==t&&1/e==-INFINITY?\"-0\":t}function isObjectLike(e){return!!e&&\"object\"==typeof e}function isSymbol(e){return\"symbol\"==typeof e||isObjectLike(e)&&objectToString.call(e)==symbolTag}function toString(e){return null==e?\"\":baseToString(e)}function escape(e){return(e=toString(e))&&reHasUnescapedHtml.test(e)?e.replace(reUnescapedHtml,escapeHtmlChar):e}module.exports=escape;\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],2:[function(require,module,exports){\n(function (global){\n(function(){var e={newline:/^\\n+/,code:/^( {4}[^\\n]+\\n*)+/,fences:a,hr:/^( *[-*_]){3,} *(?:\\n+|$)/,heading:/^ *(#{1,6}) *([^\\n]+?) *#* *(?:\\n+|$)/,nptable:a,lheading:/^([^\\n]+)\\n *(=|-){2,} *(?:\\n+|$)/,blockquote:/^( *>[^\\n]+(\\n(?!def)[^\\n]+)*\\n*)+/,list:/^( *)(bull) [\\s\\S]+?(?:hr|def|\\n{2,}(?! )(?!\\1bull )\\n*|\\s*$)/,html:/^ *(?:comment *(?:\\n|\\s*$)|closed *(?:\\n{2,}|\\s*$)|closing *(?:\\n{2,}|\\s*$))/,def:/^ *\\[([^\\]]+)\\]: *<?([^\\s>]+)>?(?: +[\"(]([^\\n]+)[\")])? *(?:\\n+|$)/,table:a,paragraph:/^((?:[^\\n]+\\n?(?!hr|heading|lheading|blockquote|tag|def))+)\\n*/,text:/^[^\\n]+/};e.bullet=/(?:[*+-]|\\d+\\.)/,e.item=/^( *)(bull) [^\\n]*(?:\\n(?!\\1bull )[^\\n]*)*/,e.item=o(e.item,\"gm\")(/bull/g,e.bullet)(),e.list=o(e.list)(/bull/g,e.bullet)(\"hr\",\"\\\\n+(?=\\\\1?(?:[-*_] *){3,}(?:\\\\n+|$))\")(\"def\",\"\\\\n+(?=\"+e.def.source+\")\")(),e._tag=\"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\\\b)\\\\w+(?!:/|[^\\\\w\\\\s@]*@)\\\\b\",e.html=o(e.html)(\"comment\",/<!--[\\s\\S]*?-->/)(\"closed\",/<(tag)[\\s\\S]+?<\\/\\1>/)(\"closing\",/<tag(?:\"[^\"]*\"|'[^']*'|[^'\">])*?>/)(/tag/g,e._tag)(),e.paragraph=o(e.paragraph)(\"hr\",e.hr)(\"heading\",e.heading)(\"lheading\",e.lheading)(\"blockquote\",e.blockquote)(\"tag\",\"<\"+e._tag)(\"def\",e.def)(),e.normal=p({},e),e.gfm=p({},e.normal,{fences:/^ *(`{3,}|~{3,})[ \\.]*(\\S+)? *\\n([\\s\\S]*?)\\s*\\1 *(?:\\n+|$)/,paragraph:/^/,heading:/^ *(#{1,6}) +([^\\n]+?) *#* *(?:\\n+|$)/}),e.gfm.paragraph=o(e.paragraph)(\"(?!\",\"(?!\"+e.gfm.fences.source.replace(\"\\\\1\",\"\\\\2\")+\"|\"+e.list.source.replace(\"\\\\1\",\"\\\\3\")+\"|\")(),e.tables=p({},e.gfm,{nptable:/^ *(\\S.*\\|.*)\\n *([-:]+ *\\|[-| :]*)\\n((?:.*\\|.*(?:\\n|$))*)\\n*/,table:/^ *\\|(.+)\\n *\\|( *[-:]+[-| :]*)\\n((?: *\\|.*(?:\\n|$))*)\\n*/});function t(t){this.tokens=[],this.tokens.links={},this.options=t||u.defaults,this.rules=e.normal,this.options.gfm&&(this.options.tables?this.rules=e.tables:this.rules=e.gfm)}t.rules=e,t.lex=function(e,n){return new t(n).lex(e)},t.prototype.lex=function(e){return e=e.replace(/\\r\\n|\\r/g,\"\\n\").replace(/\\t/g,\"    \").replace(/\\u00a0/g,\" \").replace(/\\u2424/g,\"\\n\"),this.token(e,!0)},t.prototype.token=function(t,n,s){var r,i,l,o,h,a,p,u,c;for(t=t.replace(/^ +$/gm,\"\");t;)if((l=this.rules.newline.exec(t))&&(t=t.substring(l[0].length),l[0].length>1&&this.tokens.push({type:\"space\"})),l=this.rules.code.exec(t))t=t.substring(l[0].length),l=l[0].replace(/^ {4}/gm,\"\"),this.tokens.push({type:\"code\",text:this.options.pedantic?l:l.replace(/\\n+$/,\"\")});else if(l=this.rules.fences.exec(t))t=t.substring(l[0].length),this.tokens.push({type:\"code\",lang:l[2],text:l[3]||\"\"});else if(l=this.rules.heading.exec(t))t=t.substring(l[0].length),this.tokens.push({type:\"heading\",depth:l[1].length,text:l[2]});else if(n&&(l=this.rules.nptable.exec(t))){for(t=t.substring(l[0].length),a={type:\"table\",header:l[1].replace(/^ *| *\\| *$/g,\"\").split(/ *\\| */),align:l[2].replace(/^ *|\\| *$/g,\"\").split(/ *\\| */),cells:l[3].replace(/\\n$/,\"\").split(\"\\n\")},u=0;u<a.align.length;u++)/^ *-+: *$/.test(a.align[u])?a.align[u]=\"right\":/^ *:-+: *$/.test(a.align[u])?a.align[u]=\"center\":/^ *:-+ *$/.test(a.align[u])?a.align[u]=\"left\":a.align[u]=null;for(u=0;u<a.cells.length;u++)a.cells[u]=a.cells[u].split(/ *\\| */);this.tokens.push(a)}else if(l=this.rules.lheading.exec(t))t=t.substring(l[0].length),this.tokens.push({type:\"heading\",depth:\"=\"===l[2]?1:2,text:l[1]});else if(l=this.rules.hr.exec(t))t=t.substring(l[0].length),this.tokens.push({type:\"hr\"});else if(l=this.rules.blockquote.exec(t))t=t.substring(l[0].length),this.tokens.push({type:\"blockquote_start\"}),l=l[0].replace(/^ *> ?/gm,\"\"),this.token(l,n,!0),this.tokens.push({type:\"blockquote_end\"});else if(l=this.rules.list.exec(t)){for(t=t.substring(l[0].length),o=l[2],this.tokens.push({type:\"list_start\",ordered:o.length>1}),r=!1,c=(l=l[0].match(this.rules.item)).length,u=0;u<c;u++)p=(a=l[u]).length,~(a=a.replace(/^ *([*+-]|\\d+\\.) +/,\"\")).indexOf(\"\\n \")&&(p-=a.length,a=this.options.pedantic?a.replace(/^ {1,4}/gm,\"\"):a.replace(new RegExp(\"^ {1,\"+p+\"}\",\"gm\"),\"\")),this.options.smartLists&&u!==c-1&&(o===(h=e.bullet.exec(l[u+1])[0])||o.length>1&&h.length>1||(t=l.slice(u+1).join(\"\\n\")+t,u=c-1)),i=r||/\\n\\n(?!\\s*$)/.test(a),u!==c-1&&(r=\"\\n\"===a.charAt(a.length-1),i||(i=r)),this.tokens.push({type:i?\"loose_item_start\":\"list_item_start\"}),this.token(a,!1,s),this.tokens.push({type:\"list_item_end\"});this.tokens.push({type:\"list_end\"})}else if(l=this.rules.html.exec(t))t=t.substring(l[0].length),this.tokens.push({type:this.options.sanitize?\"paragraph\":\"html\",pre:!this.options.sanitizer&&(\"pre\"===l[1]||\"script\"===l[1]||\"style\"===l[1]),text:l[0]});else if(!s&&n&&(l=this.rules.def.exec(t)))t=t.substring(l[0].length),this.tokens.links[l[1].toLowerCase()]={href:l[2],title:l[3]};else if(n&&(l=this.rules.table.exec(t))){for(t=t.substring(l[0].length),a={type:\"table\",header:l[1].replace(/^ *| *\\| *$/g,\"\").split(/ *\\| */),align:l[2].replace(/^ *|\\| *$/g,\"\").split(/ *\\| */),cells:l[3].replace(/(?: *\\| *)?\\n$/,\"\").split(\"\\n\")},u=0;u<a.align.length;u++)/^ *-+: *$/.test(a.align[u])?a.align[u]=\"right\":/^ *:-+: *$/.test(a.align[u])?a.align[u]=\"center\":/^ *:-+ *$/.test(a.align[u])?a.align[u]=\"left\":a.align[u]=null;for(u=0;u<a.cells.length;u++)a.cells[u]=a.cells[u].replace(/^ *\\| *| *\\| *$/g,\"\").split(/ *\\| */);this.tokens.push(a)}else if(n&&(l=this.rules.paragraph.exec(t)))t=t.substring(l[0].length),this.tokens.push({type:\"paragraph\",text:\"\\n\"===l[1].charAt(l[1].length-1)?l[1].slice(0,-1):l[1]});else if(l=this.rules.text.exec(t))t=t.substring(l[0].length),this.tokens.push({type:\"text\",text:l[0]});else if(t)throw new Error(\"Infinite loop on byte: \"+t.charCodeAt(0));return this.tokens};var n={escape:/^\\\\([\\\\`*{}\\[\\]()#+\\-.!_>])/,autolink:/^<([^ >]+(@|:\\/)[^ >]+)>/,url:a,tag:/^<!--[\\s\\S]*?-->|^<\\/?\\w+(?:\"[^\"]*\"|'[^']*'|[^'\">])*?>/,link:/^!?\\[(inside)\\]\\(href\\)/,reflink:/^!?\\[(inside)\\]\\s*\\[([^\\]]*)\\]/,nolink:/^!?\\[((?:\\[[^\\]]*\\]|[^\\[\\]])*)\\]/,strong:/^__([\\s\\S]+?)__(?!_)|^\\*\\*([\\s\\S]+?)\\*\\*(?!\\*)/,em:/^\\b_((?:[^_]|__)+?)_\\b|^\\*((?:\\*\\*|[\\s\\S])+?)\\*(?!\\*)/,code:/^(`+)([\\s\\S]*?[^`])\\1(?!`)/,br:/^ {2,}\\n(?!\\s*$)/,del:a,text:/^[\\s\\S]+?(?=[\\\\<!\\[_*`]| {2,}\\n|$)/};n._inside=/(?:\\[[^\\]]*\\]|[^\\[\\]]|\\](?=[^\\[]*\\]))*/,n._href=/\\s*<?([\\s\\S]*?)>?(?:\\s+['\"]([\\s\\S]*?)['\"])?\\s*/,n.link=o(n.link)(\"inside\",n._inside)(\"href\",n._href)(),n.reflink=o(n.reflink)(\"inside\",n._inside)(),n.normal=p({},n),n.pedantic=p({},n.normal,{strong:/^__(?=\\S)([\\s\\S]*?\\S)__(?!_)|^\\*\\*(?=\\S)([\\s\\S]*?\\S)\\*\\*(?!\\*)/,em:/^_(?=\\S)([\\s\\S]*?\\S)_(?!_)|^\\*(?=\\S)([\\s\\S]*?\\S)\\*(?!\\*)/}),n.gfm=p({},n.normal,{escape:o(n.escape)(\"])\",\"~|])\")(),url:/^(https?:\\/\\/[^\\s<]+[^<.,:;\"')\\]\\s])/,del:/^~~(?=\\S)([\\s\\S]*?\\S)~~/,text:o(n.text)(\"]|\",\"~]|\")(\"|\",\"|https?://|\")()}),n.breaks=p({},n.gfm,{br:o(n.br)(\"{2,}\",\"*\")(),text:o(n.gfm.text)(\"{2,}\",\"*\")()});function s(e,t){if(this.options=t||u.defaults,this.links=e,this.rules=n.normal,this.renderer=this.options.renderer||new r,this.renderer.options=this.options,!this.links)throw new Error(\"Tokens array requires a `links` property.\");this.options.gfm?this.options.breaks?this.rules=n.breaks:this.rules=n.gfm:this.options.pedantic&&(this.rules=n.pedantic)}s.rules=n,s.output=function(e,t,n){return new s(t,n).output(e)},s.prototype.output=function(e){for(var t,n,s,r,i=\"\";e;)if(r=this.rules.escape.exec(e))e=e.substring(r[0].length),i+=r[1];else if(r=this.rules.autolink.exec(e))e=e.substring(r[0].length),\"@\"===r[2]?(n=l(\":\"===r[1].charAt(6)?this.mangle(r[1].substring(7)):this.mangle(r[1])),s=this.mangle(\"mailto:\")+n):s=n=l(r[1]),i+=this.renderer.link(s,null,n);else if(this.inLink||!(r=this.rules.url.exec(e))){if(r=this.rules.tag.exec(e))!this.inLink&&/^<a /i.test(r[0])?this.inLink=!0:this.inLink&&/^<\\/a>/i.test(r[0])&&(this.inLink=!1),e=e.substring(r[0].length),i+=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(r[0]):l(r[0]):r[0];else if(r=this.rules.link.exec(e))e=e.substring(r[0].length),this.inLink=!0,i+=this.outputLink(r,{href:r[2],title:r[3]}),this.inLink=!1;else if((r=this.rules.reflink.exec(e))||(r=this.rules.nolink.exec(e))){if(e=e.substring(r[0].length),t=(r[2]||r[1]).replace(/\\s+/g,\" \"),!(t=this.links[t.toLowerCase()])||!t.href){i+=r[0].charAt(0),e=r[0].substring(1)+e;continue}this.inLink=!0,i+=this.outputLink(r,t),this.inLink=!1}else if(r=this.rules.strong.exec(e))e=e.substring(r[0].length),i+=this.renderer.strong(this.output(r[2]||r[1]));else if(r=this.rules.em.exec(e))e=e.substring(r[0].length),i+=this.renderer.em(this.output(r[2]||r[1]));else if(r=this.rules.code.exec(e))e=e.substring(r[0].length),i+=this.renderer.codespan(l(r[2].trim(),!0));else if(r=this.rules.br.exec(e))e=e.substring(r[0].length),i+=this.renderer.br();else if(r=this.rules.del.exec(e))e=e.substring(r[0].length),i+=this.renderer.del(this.output(r[1]));else if(r=this.rules.text.exec(e))e=e.substring(r[0].length),i+=this.renderer.text(l(this.smartypants(r[0])));else if(e)throw new Error(\"Infinite loop on byte: \"+e.charCodeAt(0))}else e=e.substring(r[0].length),s=n=l(r[1]),i+=this.renderer.link(s,null,n);return i},s.prototype.outputLink=function(e,t){var n=l(t.href),s=t.title?l(t.title):null;return\"!\"!==e[0].charAt(0)?this.renderer.link(n,s,this.output(e[1])):this.renderer.image(n,s,l(e[1]))},s.prototype.smartypants=function(e){return this.options.smartypants?e.replace(/---/g,\"—\").replace(/--/g,\"–\").replace(/(^|[-\\u2014/(\\[{\"\\s])'/g,\"$1‘\").replace(/'/g,\"’\").replace(/(^|[-\\u2014/(\\[{\\u2018\\s])\"/g,\"$1“\").replace(/\"/g,\"”\").replace(/\\.{3}/g,\"…\"):e},s.prototype.mangle=function(e){if(!this.options.mangle)return e;for(var t,n=\"\",s=e.length,r=0;r<s;r++)t=e.charCodeAt(r),Math.random()>.5&&(t=\"x\"+t.toString(16)),n+=\"&#\"+t+\";\";return n};function r(e){this.options=e||{}}r.prototype.code=function(e,t,n){if(this.options.highlight){var s=this.options.highlight(e,t);null!=s&&s!==e&&(n=!0,e=s)}return t?'<pre><code class=\"'+this.options.langPrefix+l(t,!0)+'\">'+(n?e:l(e,!0))+\"\\n</code></pre>\\n\":\"<pre><code>\"+(n?e:l(e,!0))+\"\\n</code></pre>\"},r.prototype.blockquote=function(e){return\"<blockquote>\\n\"+e+\"</blockquote>\\n\"},r.prototype.html=function(e){return e},r.prototype.heading=function(e,t,n){return\"<h\"+t+' id=\"'+this.options.headerPrefix+n.toLowerCase().replace(/[^\\w]+/g,\"-\")+'\">'+e+\"</h\"+t+\">\\n\"},r.prototype.hr=function(){return this.options.xhtml?\"<hr/>\\n\":\"<hr>\\n\"},r.prototype.list=function(e,t){var n=t?\"ol\":\"ul\";return\"<\"+n+\">\\n\"+e+\"</\"+n+\">\\n\"},r.prototype.listitem=function(e){return\"<li>\"+e+\"</li>\\n\"},r.prototype.paragraph=function(e){return\"<p>\"+e+\"</p>\\n\"},r.prototype.table=function(e,t){return\"<table>\\n<thead>\\n\"+e+\"</thead>\\n<tbody>\\n\"+t+\"</tbody>\\n</table>\\n\"},r.prototype.tablerow=function(e){return\"<tr>\\n\"+e+\"</tr>\\n\"},r.prototype.tablecell=function(e,t){var n=t.header?\"th\":\"td\";return(t.align?\"<\"+n+' style=\"text-align:'+t.align+'\">':\"<\"+n+\">\")+e+\"</\"+n+\">\\n\"},r.prototype.strong=function(e){return\"<strong>\"+e+\"</strong>\"},r.prototype.em=function(e){return\"<em>\"+e+\"</em>\"},r.prototype.codespan=function(e){return\"<code>\"+e+\"</code>\"},r.prototype.br=function(){return this.options.xhtml?\"<br/>\":\"<br>\"},r.prototype.del=function(e){return\"<del>\"+e+\"</del>\"},r.prototype.link=function(e,t,n){if(this.options.sanitize){try{var s=decodeURIComponent((r=e,r.replace(/&(#(?:\\d+)|(?:#x[0-9A-Fa-f]+)|(?:\\w+));?/gi,function(e,t){return\"colon\"===(t=t.toLowerCase())?\":\":\"#\"===t.charAt(0)?\"x\"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):\"\"}))).replace(/[^\\w:]/g,\"\").toLowerCase()}catch(e){return\"\"}if(0===s.indexOf(\"javascript:\")||0===s.indexOf(\"vbscript:\")||0===s.indexOf(\"data:\"))return\"\"}var r;this.options.baseUrl&&!originIndependentUrl.test(e)&&(e=h(this.options.baseUrl,e));var i='<a href=\"'+e+'\"';return t&&(i+=' title=\"'+t+'\"'),i+=\">\"+n+\"</a>\"},r.prototype.image=function(e,t,n){this.options.baseUrl&&!originIndependentUrl.test(e)&&(e=h(this.options.baseUrl,e));var s='<img src=\"'+e+'\" alt=\"'+n+'\"';return t&&(s+=' title=\"'+t+'\"'),s+=this.options.xhtml?\"/>\":\">\"},r.prototype.text=function(e){return e};function i(e){this.tokens=[],this.token=null,this.options=e||u.defaults,this.options.renderer=this.options.renderer||new r,this.renderer=this.options.renderer,this.renderer.options=this.options}i.parse=function(e,t,n){return new i(t,n).parse(e)},i.prototype.parse=function(e){this.inline=new s(e.links,this.options,this.renderer),this.tokens=e.reverse();for(var t=\"\";this.next();)t+=this.tok();return t},i.prototype.next=function(){return this.token=this.tokens.pop()},i.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},i.prototype.parseText=function(){for(var e=this.token.text;\"text\"===this.peek().type;)e+=\"\\n\"+this.next().text;return this.inline.output(e)},i.prototype.tok=function(){switch(this.token.type){case\"space\":return\"\";case\"hr\":return this.renderer.hr();case\"heading\":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,this.token.text);case\"code\":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case\"table\":var e,t,n,s,r=\"\",i=\"\";for(n=\"\",e=0;e<this.token.header.length;e++)({header:!0,align:this.token.align[e]}),n+=this.renderer.tablecell(this.inline.output(this.token.header[e]),{header:!0,align:this.token.align[e]});for(r+=this.renderer.tablerow(n),e=0;e<this.token.cells.length;e++){for(t=this.token.cells[e],n=\"\",s=0;s<t.length;s++)n+=this.renderer.tablecell(this.inline.output(t[s]),{header:!1,align:this.token.align[s]});i+=this.renderer.tablerow(n)}return this.renderer.table(r,i);case\"blockquote_start\":for(i=\"\";\"blockquote_end\"!==this.next().type;)i+=this.tok();return this.renderer.blockquote(i);case\"list_start\":i=\"\";for(var l=this.token.ordered;\"list_end\"!==this.next().type;)i+=this.tok();return this.renderer.list(i,l);case\"list_item_start\":for(i=\"\";\"list_item_end\"!==this.next().type;)i+=\"text\"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(i);case\"loose_item_start\":for(i=\"\";\"list_item_end\"!==this.next().type;)i+=this.tok();return this.renderer.listitem(i);case\"html\":var o=this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);return this.renderer.html(o);case\"paragraph\":return this.renderer.paragraph(this.inline.output(this.token.text));case\"text\":return this.renderer.paragraph(this.parseText())}};function l(e,t){return e.replace(t?/&/g:/&(?!#?\\w+;)/g,\"&amp;\").replace(/</g,\"&lt;\").replace(/>/g,\"&gt;\").replace(/\"/g,\"&quot;\").replace(/'/g,\"&#39;\")}function o(e,t){return e=e.source,t=t||\"\",function n(s,r){return s?(r=(r=r.source||r).replace(/(^|[^\\[])\\^/g,\"$1\"),e=e.replace(s,r),n):new RegExp(e,t)}}function h(e,t){return baseUrls[\" \"+e]||(/^[^:]+:\\/*[^/]*$/.test(e)?baseUrls[\" \"+e]=e+\"/\":baseUrls[\" \"+e]=e.replace(/[^/]*$/,\"\")),e=baseUrls[\" \"+e],\"//\"===t.slice(0,2)?e.replace(/:[^]*/,\":\")+t:\"/\"===t.charAt(0)?e.replace(/(:\\/*[^/]*)[^]*/,\"$1\")+t:e+t}baseUrls={},originIndependentUrl=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function a(){}a.exec=a;function p(e){for(var t,n,s=1;s<arguments.length;s++){t=arguments[s];for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}function u(e,n,s){if(s||\"function\"==typeof n){s||(s=n,n=null);var r,o,h=(n=p({},u.defaults,n||{})).highlight,a=0;try{r=t.lex(e,n)}catch(e){return s(e)}o=r.length;var c=function(e){if(e)return n.highlight=h,s(e);var t;try{t=i.parse(r,n)}catch(t){e=t}return n.highlight=h,e?s(e):s(null,t)};if(!h||h.length<3)return c();if(delete n.highlight,!o)return c();for(;a<r.length;a++)!function(e){\"code\"!==e.type?--o||c():h(e.text,e.lang,function(t,n){return t?c(t):null==n||n===e.text?--o||c():(e.text=n,e.escaped=!0,void(--o||c()))})}(r[a])}else try{return n&&(n=p({},u.defaults,n)),i.parse(t.lex(e,n),n)}catch(e){if(e.message+=\"\\nPlease report this to https://github.com/chjj/marked.\",(n||u.defaults).silent)return\"<p>An error occured:</p><pre>\"+l(e.message+\"\",!0)+\"</pre>\";throw e}}u.options=u.setOptions=function(e){return p(u.defaults,e),u},u.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,sanitizer:null,mangle:!0,smartLists:!1,silent:!1,highlight:null,langPrefix:\"lang-\",smartypants:!1,headerPrefix:\"\",renderer:new r,xhtml:!1,baseUrl:null},u.Parser=i,u.parser=i.parse,u.Renderer=r,u.Lexer=t,u.lexer=t.lex,u.InlineLexer=s,u.inlineLexer=s.output,u.parse=u,\"undefined\"!=typeof module&&\"object\"==typeof exports?module.exports=u:\"function\"==typeof define&&define.amd?define(function(){return u}):this.marked=u}).call(function(){return this||(\"undefined\"!=typeof window?window:global)}());\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],3:[function(require,module,exports){\n\"use strict\";module.exports=function(r,e){if(\"string\"!=typeof r)throw new TypeError(\"Expected a string in the first argument, got \"+typeof r);if(!(e&&e.preserveNewlines))return r.split(/\\r?\\n/);for(var t=r.split(/(\\r?\\n)/),n=[],i=0;i<t.length;i+=2)n.push(t[i]+(t[i+1]||\"\"));return n};\n\n},{}],4:[function(require,module,exports){\n\"use strict\";var colors=require(\"./colors\"),appearanceStyle=void 0,googleFontStyle=void 0,props={bg:\"pale blue gray\",borderColor:\"dark gray\",borderStyle:\"shadow\",borderWidth:1,fg:\"dark gray\",font:\"Georgia, serif\",fontSize:18,googleFont:\"\",linkActiveColor:\"pink\",linkColor:\"dark gray\",linkStyle:\"underline\",linkUnderlineColor:\"pink\",pageBg:\"white\",pageFg:\"dark-gray\"};function setStyle(){function o(o){return colors[o]||o}function e(o){return\"number\"==typeof o?o+\"px\":o}props.googleFont&&(googleFontStyle||(googleFontStyle=document.createElement(\"div\"),document.querySelector(\"body\").appendChild(googleFontStyle)),googleFontStyle.innerHTML=props.googleFont),appearanceStyle||(appearanceStyle=document.createElement(\"style\"),document.querySelector(\"body\").appendChild(appearanceStyle));var t=\"\";switch(props.borderStyle){case\"shadow\":t=\"box-shadow: 0 4px 8px hsla(0, 0%, 0%, 0.25); border: none;\";break;case\"line\":t=\"border: \"+e(props.borderWidth)+\" solid \"+o(props.borderColor)+\"; box-shadow: none;\"}var r=\"\";switch(props.linkStyle){case\"underline\":r=\"text-decoration: underline;\";break;case\"small caps\":r=\"text-decoration: none; text-transform: uppercase; font-size: 75%; letter-spacing: 0.02em;\";break;case\"italics\":r=\"text-decoration: none; font-style: italic;\"}appearanceStyle.innerHTML='\\n\\t\\tbody {\\n\\t\\t\\tfont-family: \"'+props.font+'\";\\n\\t\\t\\tbackground-color: '+o(props.bg)+\";\\n\\t\\t\\tcolor: \"+o(props.fg)+\";\\n\\t\\t}\\n\\n\\t\\ta {\\n\\t\\t\\tcolor: \"+o(props.linkColor)+\";\\n\\t\\t\\ttext-decoration-color: \"+o(props.linkUnderlineColor)+\";\\n\\t\\t\\t\"+r+\"\\n\\t\\t}\\n\\n\\t\\ta:hover {\\n\\t\\t\\tcolor: \"+o(props.linkActiveColor)+\";\\n\\t\\t}\\n\\n\\t\\t.page {\\n\\t\\t\\tbackground-color: \"+o(props.pageBg)+\";\\n\\t\\t\\tcolor: \"+o(props.pageFg)+\";\\n\\t\\t\\tfont-size: \"+e(props.fontSize)+\";\\n\\t\\t\\t\"+t+\"\\n\\t\\t}\\n\\t\"}var Appearance={};function styleSetter(o,e){props[o]=e,setStyle()}function addProp(o){Object.defineProperty(Appearance,o,{get:function(){return props[o]},set:function(e){styleSetter(o,e)}})}addProp(\"bg\"),addProp(\"borderColor\"),addProp(\"borderStyle\"),addProp(\"borderWidth\"),addProp(\"fg\"),addProp(\"font\"),addProp(\"fontSize\"),addProp(\"googleFont\"),addProp(\"linkActiveColor\"),addProp(\"linkColor\"),addProp(\"linkStyle\"),addProp(\"linkUnderlineColor\"),addProp(\"pageBg\"),addProp(\"pageFg\"),module.exports=Appearance;\n\n},{\"./colors\":5}],5:[function(require,module,exports){\n\"use strict\";module.exports={black:\"#000000\",white:\"#ffffff\",red:\"#f44336\",\"pale red\":\"#ffebee\",\"light red\":\"#ef9a9a\",\"dark red\":\"#b71c1c\",pink:\"#e91e63\",\"pale pink\":\"#fce4ec\",\"light pink\":\"#f48fb1\",\"dark pink\":\"#880e4f\",purple:\"#9c27b0\",\"pale purple\":\"#f3e5f5\",\"light purple\":\"#ce93d8\",\"dark purple\":\"#4a148c\",\"deep purple\":\"#673ab7\",\"pale deep purple\":\"#ede7f6\",\"light deep purple\":\"#b39ddb\",\"dark deep purple\":\"#311b92\",indigo:\"#3f51b5\",\"pale indigo\":\"#e8eaf6\",\"light indigo\":\"#9fa8da\",\"dark indigo\":\"#1a237e\",blue:\"#2196f3\",\"pale blue\":\"#e3f2fd\",\"light blue\":\"#90caf9\",\"dark blue\":\"#0d47a1\",cyan:\"#00bcd4\",\"pale cyan\":\"#e0f7fa\",\"light cyan\":\"#80deea\",\"dark cyan\":\"#006064\",teal:\"#009688\",\"pale teal\":\"#e0f2f1\",\"light teal\":\"#80cbc4\",\"dark teal\":\"#004d40\",green:\"#4caf50\",\"pale green\":\"#e8f5e9\",\"light green\":\"#a5d6a7\",\"dark green\":\"#1b5e20\",lime:\"#cddc39\",\"pale lime\":\"#f9fbe7\",\"light lime\":\"#e6ee9c\",\"dark lime\":\"#827717\",yellow:\"#ffeb3b\",\"pale yellow\":\"#fffde7\",\"light yellow\":\"#fff59d\",\"dark yellow\":\"#f57f17\",amber:\"#ffc107\",\"pale amber\":\"#fff8e1\",\"light amber\":\"#ffe082\",\"dark amber\":\"#ff6f00\",orange:\"#ff9800\",\"pale orange\":\"#fff3e0\",\"light orange\":\"#ffcc80\",\"dark orange\":\"#e65100\",brown:\"#795548\",\"pale brown\":\"#efebe9\",\"light brown\":\"#bcaaa4\",\"dark brown\":\"#3e2723\",gray:\"#9e9e9e\",\"pale gray\":\"#fafafa\",\"light gray\":\"#eeeeee\",\"dark gray\":\"#212121\",\"blue gray\":\"#607d8b\",\"pale blue gray\":\"#eceff1\",\"light blue gray\":\"#b0bec5\",\"dark blue gray\":\"#263238\"};\n\n},{}],6:[function(require,module,exports){\n\"use strict\";module.exports={appearance:require(\"./appearance\")};\n\n},{\"./appearance\":4}],7:[function(require,module,exports){\n\"use strict\";var Config=require(\"./config\"),Modifiers=require(\"./modifiers\"),Parser=require(\"./template/parser\"),Persistence=require(\"./persistence\"),Renderer=require(\"./template/renderer\"),Story=require(\"./story\"),Trail=require(\"./trail\"),View=require(\"./view\"),passageLinks=require(\"./template/passage-links\"),Globals=module.exports={init:function(){Globals.parser=new Parser,Globals.renderer=new Renderer,Modifiers.addBuiltins(Globals.renderer),Globals.view=new View(document.querySelector(\".page\")),passageLinks.attachTo(Globals.view.el,Globals.go),Globals.story=new Story,Globals.story.loadFromHtml(document.querySelector(\"tw-storydata\")),Globals.persistence=new Persistence(Globals.story.name),Globals.persistence.canRestore()?Globals.trail=new Trail(Globals.persistence.restore()):Globals.trail=new Trail,Globals.config=Config,Object.assign(window,Globals),Globals.trail.length>0?Globals.view.show(Globals.render(Globals.trail.last)):Globals.restart()},go:function(e){Globals.trail.add(e),Globals.view.show(Globals.render(e)),Globals.persistence.save(Globals.trail.passages)},render:function(e){var r=Globals.story.passage(e);if(!r)throw new Error('There is no passage named \"'+e+'\".');return Globals.renderer.render(Globals.parser.parse(r.source)).html},restart:function(){var e=Globals.story.passages.find(function(e){return e.id===Globals.story.startNode});if(!e)throw new Error(\"There is no passsage with the ID \"+Global.story.startNode+\".\");Globals.persistence.delete(),Globals.trail.clear(),Globals.go(e.name)}};\n\n},{\"./config\":6,\"./modifiers\":12,\"./persistence\":13,\"./story\":14,\"./template/parser\":17,\"./template/passage-links\":18,\"./template/renderer\":19,\"./trail\":20,\"./view\":21}],8:[function(require,module,exports){\n\"use strict\";var Globals=require(\"./globals\");Globals.init();\n\n},{\"./globals\":7}],9:[function(require,module,exports){\n\"use strict\";var _createClass=function(){function e(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,\"value\"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,r,t){return r&&e(n.prototype,r),t&&e(n,t),n}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError(\"Cannot call a class as a function\")}var Append=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:\"setup\",value:function(){}},{key:\"process\",value:function(e){e.beforeText=\" \"}}]),e}();Append.regexps=[/^append$/i],module.exports=Append;\n\n},{}],10:[function(require,module,exports){\n\"use strict\";var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}var Conditionals=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:\"setup\",value:function(e){this.type=e.replace(/\\s.*/,\"\").toLowerCase(),this.lastCondition=this.condition,\"else\"!==this.type&&(this.condition=new Function(\"return \"+e.replace(/.*?\\s/,\"\"))),console.log(\"type is \"+this.type)}},{key:\"process\",value:function(e,t){switch(this.type){case\"if\":this.condition.apply(window)||(e.text=\"\");break;case\"unless\":this.condition.apply(window)&&(e.text=\"\");break;case\"else\":if(void 0===this.lastCondition)return void t.addError(\"There was no matching if modifier for an else modifier.\");this.lastCondition.apply(window)&&(e.text=\"\")}}}]),e}();Conditionals.regexps=[/^if\\s/i,/^unless\\s/i,/^else$/i],module.exports=Conditionals;\n\n},{}],11:[function(require,module,exports){\n\"use strict\";var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,\"value\"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError(\"Cannot call a class as a function\")}var Continue=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:\"setup\",value:function(){}},{key:\"process\",value:function(){}}]),e}();Continue.regexps=[/^continued$/i,/^continue$/i,/^cont'd$/i,/^cont$/i],module.exports=Continue;\n\n},{}],12:[function(require,module,exports){\n\"use strict\";var Append=require(\"./append\"),Conditionals=require(\"./conditionals\"),Continue=require(\"./continue\");module.exports={addBuiltins:function(i){i.addModifier(\"append\",Append),i.addModifier(\"conditionals\",Conditionals),i.addModifier(\"continue\",Continue)}};\n\n},{\"./append\":9,\"./conditionals\":10,\"./continue\":11}],13:[function(require,module,exports){\n\"use strict\";var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}();function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError(\"Cannot call a class as a function\")}var Persistence=function(){_createClass(e,null,[{key:\"browserEnabled\",value:function(){try{return window.localStorage.setItem(\"chapbook-test\",\"a\"),window.localStorage.removeItem(\"chapbook-test\"),!0}catch(e){return!1}}}]);function e(r){_classCallCheck(this,e),this.key=r,this.remembered=[]}return _createClass(e,[{key:\"remembered\",value:function(e){return-1!==this.remembered.indexOf(e)}},{key:\"remember\",value:function(e){if(-1!==this.remembered.indexOf(e))throw new Error('\"'+e+'\" is already being persisted.');this.remembered.push(e)}},{key:\"save\",value:function(e){try{window.localStorage.setItem(this.key,JSON.stringify({trail:e,vars:this.remembered.reduce(function(e,r){return e.r=window[r]},{})}))}catch(e){throw new Error(\"Could not save the story state (\"+e.message+\").\")}}},{key:\"canRestore\",value:function(){return e.browserEnabled()&&null!==window.localStorage.getItem(this.key)}},{key:\"restore\",value:function(){if(this.canRestore()){var e=JSON.parse(window.localStorage.getItem(this.key));return Object.keys(e.vars).forEach(function(r){return window[r]=e.vars[r]}),e.trail}return!1}},{key:\"delete\",value:function(){window.localStorage.removeItem(this.key)}}]),e}();module.exports=Persistence;\n\n},{}],14:[function(require,module,exports){\n\"use strict\";var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,\"value\"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}var Passage=require(\"./passage\");module.exports=function(){function t(e,r,a){_classCallCheck(this,t),this.view=e,this.parser=r,this.renderer=a,this.passages=[],this.customScripts=[],this.customStyles=[]}return _createClass(t,[{key:\"loadFromHtml\",value:function(t){var e=this;[\"name\",\"creator\",\"ifid\"].forEach(function(r){return e[r]=t.getAttribute(r)}),this.startNode=parseInt(t.getAttribute(\"startnode\")),this.creatorVersion=t.getAttribute(\"creator-version\");var r=function(t){return Array.from(t).map(function(t){return t.textContent})};this.customScripts=r(t.querySelectorAll('[type=\"text/twine-javascript\"]')),this.customStyles=r(t.querySelectorAll('[type=\"text/twine-css\"]')),this.passages=Array.from(t.querySelectorAll(\"tw-passagedata\")).map(function(t){var e=new Passage;return e.loadFromHtml(t),e})}},{key:\"passage\",value:function(t){return this.passages.find(function(e){return e.name===t})}}]),t}();\n\n},{\"./passage\":15}],15:[function(require,module,exports){\n\"use strict\";var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,\"value\"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}module.exports=function(){function t(){_classCallCheck(this,t),this.tags=[]}return _createClass(t,[{key:\"loadFromHtml\",value:function(t){var e=t.getAttribute(\"tags\");this.name=t.getAttribute(\"name\"),this.id=parseInt(t.getAttribute(\"pid\")),e&&(this.tags=e.split(\" \")),this.source=t.textContent}}]),t}();\n\n},{}],16:[function(require,module,exports){\n\"use strict\";var marked=require(\"marked\"),renderer=new marked.Renderer;renderer.code=function(e){return new Function(e).apply(window),\"\"},renderer.codespan=function(e){var r=new Function(\"return (\"+e+\")\").apply(window);if(null!==r&&void 0!==r)return r.toString()},module.exports=renderer;\n\n},{\"marked\":2}],17:[function(require,module,exports){\n\"use strict\";var _slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}var splitLines=require(\"split-lines\");module.exports=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.verbose=!1,this.propsSep=/^--$/m,this.modifierPattern=/^\\[(.+)\\]$/gm,Object.assign(this,t)}return _createClass(e,[{key:\"parse\",value:function(e){var t=this,r={props:{},blocks:[],warnings:[]},n=e.split(this.propsSep,2),i=void 0,o=void 0;if(2===n.length){this.verbose&&console.log(\"Props section detected\");var s=_slicedToArray(n,2);i=s[0],o=s[1],splitLines(i).forEach(function(e){if(\"\"!==e.trim()){var n=e.indexOf(\":\");if(-1!==n){var i=e.substr(0,n).trim(),o=e.substr(n+1).trim();void 0!==r.props[i]&&r.warnings.push('The property \"'+i+'\" was defined more than once; using the last value.'),t.verbose&&console.log('Setting prop \"'+i+'\" to \"'+o+'\"'),r.props[i]=o}else r.warnings.push('The line \"'+e+'\" in the properties section is missing a colon. It was ignored.')}})}else this.verbose&&console.log(\"No props section detected\"),o=n[0];for(var a=function(e,n){var i=n.trim();\"\"!==i&&(t.verbose&&console.log(\"Creating '\"+e+\"' block with content: \\\"\"+i+'\"'),r.blocks.push({type:e,content:i}))},l=new RegExp(this.modifierPattern),c=0,u=l.exec(o);u;)a(\"text\",o.substring(c,u.index)),a(\"modifier\",u[1]),c=l.lastIndex,u=l.exec(o);return a(\"text\",o.substring(c)),r}}]),e}();\n\n},{\"split-lines\":3}],18:[function(require,module,exports){\n\"use strict\";var escape=require(\"lodash.escape\");module.exports={attachTo:function(t,e){t.addEventListener(\"click\",function(t){for(var a=t.target;a&&a.getAttribute&&!a.getAttribute(\"data-passage\");)a=a.parentNode;if(a.getAttribute){var r=a.getAttribute(\"data-passage\");r&&e(r)}})},parse:function(t){var e=t;return e=e.replace(/\\[\\[(.*?)\\]\\]/g,function(t,e){var a=e,r=e.indexOf(\"|\");if(-1!==r)a=e.substr(0,r),e=e.substr(r+1);else{var s=e.indexOf(\"->\");if(-1!==s)a=e.substr(0,s),e=e.substr(s+2);else{var i=e.indexOf(\"<-\");-1!==i&&(a=e.substr(i+2),e=e.substr(0,i))}}return/^\\w+:\\/\\/\\/?\\w/i.test(e)?'<a href=\"'+e+'\">'+a+\"</a>\":'<a href=\"javascript:void(0)\" data-passage=\"'+escape(e)+'\">'+a+\"</a>\"})}};\n\n},{\"lodash.escape\":1}],19:[function(require,module,exports){\n\"use strict\";var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,\"value\"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(r,t,o){return t&&e(r.prototype,t),o&&e(r,o),r}}();function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError(\"Cannot call a class as a function\")}var marked=require(\"marked\"),EvalCodeRenderer=require(\"./eval-code-renderer\"),_require=require(\"./passage-links\"),parsePassageLinks=_require.parse;module.exports=function(){function _class(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,_class),this.verbose=!1,this.modifiers=[],this.markedOptions={renderer:EvalCodeRenderer,smartypants:!0},Object.assign(this,e)}return _createClass(_class,[{key:\"addModifier\",value:function(e,r){var t=this;if(this.modifiers.some(function(r){return r.name===e}))throw new Error('A modifier named \"'+e+'\" has already been added to this renderer');if(!r.regexps||!r.regexps.length)throw new Error(\"A modifier must have a static regexps property\");r.regexps.forEach(function(o){return t.modifiers.push({name:e,regexp:o,modifier:r})})}},{key:\"removeModifier\",value:function(e){var r=this.modifiers.length;if(this.modifiers=this.modifiers.filter(function(r){return r.name!==e}),this.modifiers.length===r)throw new Error('A modifier named \"'+e+'\" does not exist in this renderer')}},{key:\"toHtml\",value:function(e){return marked.setOptions(this.markedOptions),marked(e)}},{key:\"render\",value:function render(parsed){var _this2=this,output={markdown:\"\",html:\"\",warnings:parsed.warnings||[],errors:parsed.errors||[]};parsed.props?(this.verbose&&console.log(\"Setting props...\",parsed.props),Object.keys(parsed.props).forEach(function(name){_this2.verbose&&console.log('Setting prop \"'+name+'\"');var dotted=name.split(\".\"),target=window,finalName=void 0;dotted.length>1?(_this2.verbose&&console.log(\"Walking dotted prop name\"),finalName=dotted.pop(),dotted.forEach(function(e){void 0===target[e]&&(_this2.verbose&&console.log(\"Creating property \"+e),target[e]={}),target=target[e]})):finalName=name,target[finalName]=eval(parsed.props[name])})):console.warn(\"Renderer was given an object with no props\");var activeModifiers=[],modifierInstances={},modifierOpts={addWarning:function(e){output.warnings.push(e)},addError:function(e){output.errors.push(e)}};return parsed.blocks?parsed.blocks.forEach(function(e){switch(e.type){case\"text\":var r={text:parsePassageLinks(e.content),beforeText:\"\\n\\n\",afterText:\"\"};_this2.verbose?(console.log(\"Running \"+activeModifiers.length+\" modifiers on text block...\"),activeModifiers.forEach(function(e){e.process(r,modifierOpts),console.table(r)})):activeModifiers.forEach(function(e){return e.process(r,modifierOpts)}),output.markdown+=r.beforeText+r.text+r.afterText,activeModifiers=[],_this2.verbose&&(console.log(\"Output after modifiers:\"),console.table(r));break;case\"modifier\":var t=_this2.modifiers.filter(function(r){return r.regexp.test(e.content)});if(1===t.length){var o=t[0];_this2.verbose&&console.log('Activated \"'+o.name+'\" modifier matching ['+e.content+\"]\"),modifierInstances[o.name]||(_this2.verbose&&console.log('Creating new instance of \"'+o.name+'\" modifier'),modifierInstances[o.name]=new o.modifier),modifierInstances[o.name].setup(e.content),activeModifiers.push(modifierInstances[o.name])}else 0===t.length?output.warnings.push('No modifiers matched \"['+e.content+']\". It was ignored.'):output.warnings.push('More than one modifier matched \"['+e.content+']\". It was ignored.');break;default:throw new Error(\"Don't know how to render a block with type \\\"\"+e.type+'\".')}}):console.warn(\"Renderer was given an object with no blocks\"),output.html=this.toHtml(output.markdown),output}}]),_class}();\n\n},{\"./eval-code-renderer\":16,\"./passage-links\":18,\"marked\":2}],20:[function(require,module,exports){\n\"use strict\";var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,\"value\"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}module.exports=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];_classCallCheck(this,e),this.passages=t}return _createClass(e,[{key:\"add\",value:function(e){this.passages.push(e)}},{key:\"clear\",value:function(){this.passages=[]}},{key:\"toString\",value:function(){return this.passages.toString()}},{key:\"length\",get:function(){return this.passages.length}},{key:\"last\",get:function(){return this.passages[this.passages.length-1]}}]),e}();\n\n},{}],21:[function(require,module,exports){\n\"use strict\";var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError(\"Cannot call a class as a function\")}module.exports=function(){function e(n){_classCallCheck(this,e),this.el=n}return _createClass(e,[{key:\"show\",value:function(e){this.el.innerHTML=e}}]),e}();\n\n},{}]},{},[8]);\n</script>\n\t</body>\n</html>","version":"1.0.0"});